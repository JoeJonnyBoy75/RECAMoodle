// @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.
define("local_remuihomepage/frontpage",["jquery","core/modal_factory","core/templates","core/str","core/modal_events","local_remuihomepage/sectionmanager","core/fragment","core/ajax","core/notification","local_remuihomepage/slick"],(function($,ModalFactory,Templates,Str,ModalEvents,SECTIONMANAGER,Fragment,Ajax,Notification){var CONTEXTID=-1,MAINMODAL=null,CONFIGMODAL=null,VISIBILITY=".home-sections button.section-visibility";const RemUIEvents_SECTION_ADDED="theme_remui-frontpage-section-added",RemUIEvents_SECTION_UPDATED="theme_remui-frontpage-section-updated";var assign=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};function fetchCategories(instanceid,offset,limit,callback,fail){Ajax.call([{methodname:"local_remuihomepage_get_frontpage_categories",args:{instanceid:instanceid,offset:offset,limit:limit}}])[0].done(callback).fail(fail)}function applySlickToCourses(instanceid,options){var defaults={dots:!1,arrows:!0,infinite:!1,speed:500,prevArrow:$("section[data-instance='"+instanceid+"'] .button-container .btn-prev"),nextArrow:$("section[data-instance='"+instanceid+"'] .button-container .btn-next"),rtl:"rtl"==$("html").attr("dir"),slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:800,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]};null!==options&&"object"==typeof options&&assign(defaults,options);var section=SECTIONMANAGER.getSectionElement(instanceid);section.find(".available-courses").addClass("d-none"),0==section.find(".courses-slider .empty-courses-container").length&&(section.find(".courses-slider").slick(defaults).on("setPosition",(function(event,slick){$(section).find(".slick-slide > div").css("height","100%"),slick.$slides.css("height",slick.$slideTrack.height()+"px")})),section.find(".available-courses").removeClass("d-none"))}function generateCourses(instanceid,categoryid,callback){SECTIONMANAGER.showSectionLoader(instanceid,!0);var section=SECTIONMANAGER.getSectionElement(instanceid);section.find(".courses-slider").removeClass("show"),Ajax.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:instanceid,categoryid:categoryid},done:function(response){(response=JSON.parse(response)).shadowless=response.sectionproperties.shadowless,response.shadowcolor=response.sectionproperties.shadowcolor,section.find(".courses-slider.slick-initialized.slick-slider").slick("unslick"),section.find(".courses-slider").empty(),section.data("totalcourses",response.totalcourse),section.data("current",0),Templates.render("local_remuihomepage/courses_cards",response).done((function(html,js){Templates.appendNodeContents(section.find(".courses-slider"),html,js),applySlickToCourses(instanceid,{slidesToShow:3,slidesToScroll:3}),"function"==typeof callback&&callback()})).fail(Notification.exception),SECTIONMANAGER.showSectionLoader(instanceid,!1)},fail:function(ex){SECTIONMANAGER.showSectionLoader(instanceid,!1),Notification.exception(ex)}}])}var applyStyleToEditor=function(element){var number=$(element).attr("id").replace("id_block_","").replace("_style",""),prefix="#id_block_"+number+"_htmleditable ",style=$(element).val().replace(/(([\.\#]?[\w\d\_\-]+\s*)+\{)/,(function(match){return prefix+match}));$(element).next().is("#block-"+number+"-style")||$(element).after('<style id="block-'+number+'-style" type="text/css"></style>'),$(element).next().html(style)};function getInstanceId(element){return $(element).attr("data-instance")}var getBody=function(id,args){var params={instanceid:id};null!==args&&(params.formdata=args);var body=Fragment.loadFragment("local_remuihomepage","frontpage_section_form",CONTEXTID,params);return body.done((function(){setTimeout((function(){var styles=$("body").find("form .block-style textarea");0!=styles.length&&styles.each((function(index,element){applyStyleToEditor($(element))}))}),2e3)})),body},initializeModal=function(){!function(context){var triggerButtons=$(".add-section");ModalFactory.create({large:!0,body:Templates.render("local_remuihomepage/sections_list",context)},triggerButtons).then(function(modal){MAINMODAL=modal,modal.setTitle(M.util.get_string("addsection","local_remuihomepage")),modal.modal.addClass("modal-sidebar d-inline-flex"),modal.modal.hasClass("modal-dialog-scrollable")&&modal.modal.removeClass("modal-dialog-scrollable"),modal.modal.width("500px")}.bind(this)).fail(Notification.exception)}({sections:[{section:"slider",title:M.util.get_string("slidersection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/slider","local_remuihomepage")},{section:"aboutus",title:M.util.get_string("aboutussection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/aboutus","local_remuihomepage")},{section:"contact",title:M.util.get_string("contactsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/contact","local_remuihomepage")},{section:"feature",title:M.util.get_string("featuresection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/feature","local_remuihomepage")},{section:"courses",title:M.util.get_string("coursessection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/courses","local_remuihomepage")},{section:"team",title:M.util.get_string("teamsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/team","local_remuihomepage")},{section:"testimonial",title:M.util.get_string("testimonialsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/testimonial","local_remuihomepage")},{section:"html",title:M.util.get_string("htmlsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/html","local_remuihomepage")},{section:"separator",title:M.util.get_string("separatorsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/separator","local_remuihomepage")}]})},initializeEvents=function(){$(window).scroll((function(){if($(".pagelayout-frontpage section.lazy-section").each((function(){var sectiontop=$(this).position().top;if($(window).scrollTop()+$(window).height()+2*$(window).height()>sectiontop&&$(this).is(".lazy-section")){$(this).removeClass("lazy-section");var instanceid=$(this).data("instance"),section=SECTIONMANAGER.getLoadedSection(instanceid);SECTIONMANAGER.reloadSection({success:!0,context:section},(function(){$('.home-sections section[data-instance="'+instanceid+'"]')}))}else;})),$(".pagelayout-frontpage section.invisible").each((function(){var sectiontop=$(this).position().top+100;$(window).scrollTop()+$(window).height()>sectiontop&&setTimeout(function(){$(this).removeClass("invisible"),1==appearanimation&&("animation-slide-left-right"==appearanimationstyle?$(this).prev().is(".animation-slide-left")?$(this).addClass("animation-slide-right"):$(this).addClass("animation-slide-left"):$(this).addClass(appearanimationstyle))}.bind(this),100)})),transparentheader){if($("section[data-instance]:first-child").is(".section-slider"))if($(window).scrollTop()<45)return void $("body.has-slider").addClass("animate-header");$("body.has-slider").removeClass("animate-header")}})),$("body").on("input",".separator-style select, .separator-style input",(function(){!function(form){var style=$(form).find("#id_style").val(),color=$(form).find('[name="color"]').val(),color2=$(form).find('[name="color2"]').val(),height=$(form).find("#id_height").val(),css={margin:"0px auto",width:$(form).find("#id_width").val()+"%"};switch($(form).find('[name="color2"]').parents(".separator-style").toggleClass("d-none","gradient"!=style),style){case"blur":css.height="0px",css["background-image"]="none",css.border="1px solid "+color,css["box-shadow"]="0 0 "+height+"px "+height/2+"px "+color;break;case"blurend":css.background="none",css["box-shadow"]="none",css.border="none",css.height=height+"px",css["background-image"]="linear-gradient(to right, #ffffff, "+color+", #ffffff)";break;case"gradient":css["box-shadow"]="none",css["background-image"]="none",css.border="none",css.height=height+"px",css.background="linear-gradient(to right, "+color+" 0%, "+color2+" 50%, "+color+" 100%)";break;default:css["box-shadow"]="none",css["background-image"]="none",css.height="0px",css["border-top"]=height+"px "+style+" "+color}$(form).find("#remui_separator_output").css(css)}($(this).closest("form"))})),$("body").on("change",".updateform select",(function(){var instanceid=$(this).parents("form").find('[name="instanceid"]').val(),formdata=JSON.stringify(CONFIGMODAL.getRoot().find("form").serialize()),frag=getBody(instanceid,formdata);CONFIGMODAL.setBody(frag)})),$(document).on("click",".home-sections button.edit-section",(function(){var id=getInstanceId(this),sectionname=$(this).attr("data-sectionname");ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Edit "+M.util.get_string(sectionname+"section","local_remuihomepage"),body:getBody(id,null)}).then((function(modal){CONFIGMODAL=modal,modal.modal.addClass("modal-sidebar d-inline-flex editmodal remuihomepage"),modal.modal.hasClass("modal-dialog-scrollable")&&modal.modal.removeClass("modal-dialog-scrollable");var root=modal.getRoot();root.on(ModalEvents.save,(function(e){e.preventDefault();var form=root.find("form");function updateSectionData(){var formdata=JSON.stringify(form.serialize());SECTIONMANAGER.updateSection(id,formdata),CONFIGMODAL.hide()}if("undefined"!=typeof remui_section_form_validate){if(response=remui_section_form_validate(form),"object"==typeof response)return void response.then((function(response){response&&updateSectionData()}));if(!response)return}updateSectionData()})),root.on(ModalEvents.hidden,(function(){CONFIGMODAL.destroy(),$(document).find(".mform.atto_form.atto_media").parents(".moodle-dialogue-base").remove()})),modal.show()}))})),$(document).on("click",".home-sections button.delete-section",(function(){var id=getInstanceId(this);ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:"Delete item",body:"Do you really want to delete?"}).then((function(modal){modal.setSaveButtonText("Delete");var root=modal.getRoot();root.on(ModalEvents.save,(function(){SECTIONMANAGER.deleteInstance(id,!0)})),root.on(ModalEvents.hidden,(function(){modal.destroy()})),modal.show()}))})),$(document).on("click",".home-sections button.cancel-delete-section",(function(){var id=getInstanceId(this);SECTIONMANAGER.deleteInstance(id,!1)})),$(document).on("click",".home-sections button.confirm-delete-section",(function(){var id=getInstanceId(this);SECTIONMANAGER.deleteInstance(id,2)})),$("body").on("input",".block-style textarea",(function(){applyStyleToEditor($(this))})),$(document).on("click",".settings",(function(){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.util.get_string("homepagesettings","local_remuihomepage"),body:Fragment.loadFragment("local_remuihomepage","frontpage_settings_form",CONTEXTID)},$("#create")).done((function(modal){modal.modal.addClass("modal-sidebar d-inline-flex editmodal"),modal.modal.hasClass("modal-dialog-scrollable")&&modal.modal.removeClass("modal-dialog-scrollable"),modal.show(),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault();var form=modal.getRoot().find("form"),formdata=JSON.stringify(form.serialize());Ajax.call([{methodname:"local_remuihomepage_save_frontpage_settings",args:{settings:formdata}}])[0].done((function(response){window.location.reload()})).fail(Notification.exception),modal.hide()})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()}))}))})),$(document).on("click",".sections-container div[class*='section-']",(function(){var dataatr=$(this).data("section");MAINMODAL.hide(),SECTIONMANAGER.setSectionName(dataatr),SECTIONMANAGER.addSection()})),$("body").on("click",".moveup-section",(function(){SECTIONMANAGER.reorderSection($(this).data("instance"),-1,!0)})).on("click",".movedown-section",(function(){SECTIONMANAGER.reorderSection($(this).data("instance"),1,!0)})),$("body").on("click",VISIBILITY,(function(){var instanceid=$(this).data("instance"),visible=$(this).data("visible");SECTIONMANAGER.updateVisibility(instanceid,!visible)})),$(document).on("slid.bs.carousel",".home-sections section .carousel",(function(){var instanceid=$(this).parent().data("instance");SECTIONMANAGER.playSliderVideo(instanceid)})),$(document).on("click",".editing-action",(function(){var form=$('<form method="post"></form>');form.append("<input type='hidden' name='frontpageediting' value='1'/>"),form.append("<input type='hidden' name='editpage' value='"+$(this).data("edit")+"'/>"),$("body").append(form),form.submit()})),$(document).on("click",".publish",(function(){var form=$('<form method="post"></form>');form.append("<input type='hidden' name='frontpageediting' value='1'/>"),form.append("<input type='hidden' name='publish' value='1'/>"),$("body").append(form),form.submit()})),$(document).on("click",".preview-section",(function(){SECTIONMANAGER.showAllSectionsLoader(),$(this).find("i").toggleClass("fa-eye fa-eye-slash");var previewon=$(this).find("i").is(".fa-eye-slash");if($("body").toggleClass("preview",previewon),$(".settings,.publish,.add-section,.editing-action,.editing-alert").toggleClass("d-flex",!previewon).toggleClass("d-none",previewon),$("html, body").animate({scrollTop:0},$(window).scrollTop()/6),$(VISIBILITY+" .fa-eye-slash").parents("section[data-instance]").toggleClass("section-invisible",previewon),transparentheader)if(console.log("We should not come here"),previewon){var sections=$("body").find("section[data-instance]:not(.section-invisible)"),hasslider=!1;sections&&(hasslider=$(sections[0]).is(".section-slider")),$("body").toggleClass("has-slider animate-header",hasslider)}else $("body").toggleClass("has-slider animate-header",$("body").find("section[data-instance]:first-child").is(".section-slider"));setTimeout((function(){SECTIONMANAGER.hideAllSectionsLoader()}),2e3)})),$(document).on(RemUIEvents_SECTION_ADDED+" "+RemUIEvents_SECTION_UPDATED,(function(event){if("courses"===event.configdata.sectionname){var section=SECTIONMANAGER.getSectionElement(event.configdata.id);if(section.is(".categoryandcourses-view")&&0!=event.configdata.categorylist.length){var firstcat=event.configdata.categorylist[0].categoryid;generateCourses(event.configdata.id,firstcat)}else applySlickToCourses(section.data("instance"),{})}})),$("body").on("click",".home-sections .section-courses .category-list .category-item",(function(){var instanceid=$(this).parents("section[data-instance]").data("instance");$(this).parents("section[data-instance]").find(".courses-slider").removeClass("show"),generateCourses(instanceid,$(this).data("id"),function(){$(this).siblings().removeClass("active"),$(this).addClass("active"),$(this).parents(".category-list").removeClass("show")}.bind(this))})),$("body").on("click",".home-sections .section-courses .category-list .site-skintools-toggle",(function(){$(this).parents(".category-list").toggleClass("show")})).on("afterChange",'[data-sectionname="courses"].section-courses:not(.categories-view) .courses-slider',(function(event,slick,currentSlide){if($(slick.$nextArrow).is(".slick-disabled")){var section=$(this).closest('section[data-sectionname="courses"]'),categoryid=$(section).is(".categoryandcourses-view")?$(section).find(".category-list .category-item.active").data("id"):0,instanceid=section.data("instance"),totalcourses=section.data("totalcourses"),current=section.data("current");current+25<totalcourses&&Ajax.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:instanceid,categoryid:categoryid,start:current+25}}])[0].done((function(response){var rendered=0;SECTIONMANAGER.showSectionLoader(instanceid,!0),response=JSON.parse(response),section.data("current",current+25),response.courses.forEach((function(course){course.sectionproperties=response.sectionproperties,course.shadowless=response.sectionproperties.shadowless,Templates.render("local_remuihomepage/course_card_grid",course).done((function(html,js){html="<div><div>"+html+"</div></div>",$(slick.$slider).slick("slickAdd",html),++rendered==response.courses.length&&SECTIONMANAGER.showSectionLoader(instanceid,!1)})).fail(Notification.exception)}))})).fail(Notification.exception)}})).on("afterChange",'[data-sectionname="courses"].section-courses.categories-view .courses-slider',(function(event,slick,currentSlide){if($(slick.$nextArrow).is(".slick-disabled")){var section=$(this).closest('section[data-sectionname="courses"]'),instanceid=section.data("instance"),categories=section.find(".category-wrapper").data("categories"),categoriesloaded=section.find(".category-wrapper").data("categories-loaded");categoriesloaded<categories&&(SECTIONMANAGER.showSectionLoader(instanceid,!0),fetchCategories(instanceid,categoriesloaded+1,20,(function(response){var rendered=0;response=JSON.parse(response),section.find(".category-wrapper").data("categories-loaded",categoriesloaded+response.categorylist.length),response.categorylist.forEach((function(category){category.sectionproperties=response.sectionproperties,category.shadowless=response.sectionproperties.shadowless,Templates.render("local_remuihomepage/category_container",category).done((function(html,js){html="<div><div>"+html+"</div></div>",$(slick.$slider).slick("slickAdd",html),++rendered==response.categorylist.length&&SECTIONMANAGER.showSectionLoader(instanceid,!1)})).fail((function(ex){Notification.exception(ex),SECTIONMANAGER.showSectionLoader(instanceid,!1)}))}))}),(function(ex){Notification.exception(ex),SECTIONMANAGER.showSectionLoader(instanceid,!1)})))}})).on("card-list-scroll",(function(event,instanceid){var section=$('[data-instance="'+instanceid+'"][data-sectionname="courses"].categoryandcourses-view'),list=section.find(".card-list");if($(list).scrollTop()+$(list).innerHeight()>=$(list)[0].scrollHeight){instanceid=section.data("instance");var categories=section.find(".course-category-wrapper").data("categories"),categoriesloaded=section.find(".course-category-wrapper").data("categories-loaded");categoriesloaded<categories&&(SECTIONMANAGER.showSectionLoader(instanceid,!0),fetchCategories(instanceid,categoriesloaded+1,50,(function(response){(response=JSON.parse(response)).shadowless=response.sectionproperties.shadowless,section.find(".course-category-wrapper").data("categories-loaded",categoriesloaded+response.categorylist.length),Templates.render("local_remuihomepage/course_categories",response).done((function(html,js){Templates.appendNodeContents($(list),html,js),SECTIONMANAGER.showSectionLoader(instanceid,!1)})).fail((function(ex){Notification.exception(ex),SECTIONMANAGER.showSectionLoader(instanceid,!1)}))}),(function(ex){Notification.exception(ex),SECTIONMANAGER.showSectionLoader(instanceid,!1)})))}}))};return{init:function(contextid,userisediting){CONTEXTID=contextid,userisediting&&initializeModal(),$(document).ready((function(){initializeEvents(),SECTIONMANAGER.LoadAllSections()}))}}}));

//# sourceMappingURL=frontpage.min.js.map