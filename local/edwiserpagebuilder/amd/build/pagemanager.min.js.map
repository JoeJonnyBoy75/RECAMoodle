{"version":3,"file":"pagemanager.min.js","sources":["../src/pagemanager.js"],"sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable no-unused-vars */\n/* eslint-disable require-jsdoc */\n/* eslint-disable valid-jsdoc */\n/* eslint-disable */\ndefine(['jquery', 'core/ajax', 'core/templates'], function($, Ajax, Templates){\n\n    let previewModalId = \"#epb_preview_window\";\n\n    let pagelayoutbody = \".addpage-modal-body\";\n\n    let buttonPreview  = \".btn-preview\";\n    let buttonCancel = previewModalId + \" .cancel\";\n    let buttonAction = previewModalId + \" .actionbtn\";\n    let buttonExpand = previewModalId + \" .expand-preview\";\n    let previewImgContainer = previewModalId + \" .preview_image_container\";\n    let previewModalBody = previewModalId + \" .modal-body\";\n\n    let pagesselector = \"#pagesselector\";\n\n    let editPageFormId = \"#pageEditForm\";\n    let inputFieldsSelector = editPageFormId + \" input, \" + editPageFormId + \" select\";\n\n    // TODO :: Update the content on update button click.\n    // TODO :: Delete the blocks on delete button click.\n\n    // FORM ELEMENTS\n\n    let fullscreenselector = \"#fullscreenselector\";\n    let pagenameselector = \"#pagename\";\n\n    const registerEvents = () => {\n\n        // Close Modal\n        $(document).on(\"click\", buttonCancel, function(){\n            var modalselector = $(this).attr(\"data-modal-id\");\n            $(\"#\" + modalselector).remove();\n        });\n\n        // Select Respective Page template\n        $(document).on(\"click\", buttonExpand, function(){\n            $(previewModalBody).removeClass(\"showtemplateform\");\n            updateAction(\"usetemplate\"); // Update the button\n        });\n        $(document).on(\"click\", previewImgContainer, function(){\n            $(previewModalBody).removeClass(\"showtemplateform\");\n            updateAction(\"usetemplate\"); // Update the button\n        });\n\n        // Select Respective Page template\n        $(document).on(\"click\", buttonAction, function(){\n\n            var actiontoperform = $(this).attr(\"data-action\");\n\n            switch (actiontoperform) {\n                case \"usetemplate\" :\n                    $(previewModalBody).addClass(\"showtemplateform\");\n                    initForm(); // initialize form at first load\n                    break;\n                case \"update\" :\n                    if (validateForm()) {\n                        let text = \"Confirming this will override the configuration, continue?\";\n                        if (confirm(text) == true) {\n                            // Update existing page config\n                            performAction(\"update\");\n                            // TODO : Redirect User to Particular page.\n                        }\n                    }\n                    break;\n                case \"create\" :\n                    if (validateForm()) {\n                        // Create New page & Redirect User to Particular page.\n                        performAction(\"create\", true);\n                    }\n                    break;\n                default: break;\n            }\n\n        });\n\n        // reinitialize form after page change\n        $(document).on(\"change\", pagesselector, function(){\n            initForm();\n        });\n\n        // Enable Modifications\n        $(document).on(\"change\", fullscreenselector, function(){\n            $(buttonAction).removeAttr(\"disabled\");\n        });\n        $(document).on(\"keypress\", pagenameselector, function(){\n            $(buttonAction).removeAttr(\"disabled\");\n        });\n\n        // Loads all the pages on first load.\n        $(document).on('click', \"#pagelayout-tab.loadpagelayouts\", function() {\n            Ajax.call([{\n                methodname: 'local_edwiserpagebuilder_render_page_cards',\n                args: {},\n                done: function(data) {\n                    $(pagelayoutbody).empty().append(data.html);\n                    $(\"#pagelayout-tab.loadpagelayouts\").removeClass(\"loadpagelayouts\");\n                },\n                fail:function(){\n                }\n            }]);\n        });\n\n        // Generate Preview Modal\n        $(document).on(\"click\", buttonPreview, function(){\n            Ajax.call([{\n                methodname: 'local_edwiserpagebuilder_fetch_page_details',\n                args: {pageid: $(this).attr(\"data-page-id\")},\n                done: function(data) {\n                    Templates.renderForPromise('local_edwiserpagebuilder/preview_window', JSON.parse(data))\n                    .then(({html, js}) => {\n                        Templates.appendNodeContents('body', html, js);\n                        registerDynamicFormValidator();\n                    });\n                },\n                fail:function() {\n                    console.log(\"We have error\");\n                }\n            }]);\n        });\n    };\n\n    // Initialize Form Data\n    const initForm = () => {\n        // Fetching the pageid\n        var instid = $(pagesselector).find(':selected').data(\"instid\");\n\n        // Updating the button text\n        if (instid == undefined || instid == 0) {\n            updateAction(\"create\");\n        } else {\n            updateAction(\"update\", true);\n        }\n\n        // Updating the form elements\n        $.each(jQuery(\"#pagesselector\").find(':selected').data(), function(i, v) {\n            $('[name=\"'+i+'\"]').val(v);\n        });\n    };\n\n    // Change the button text\n    const updateAction = (action, disablebtn = false) => {\n        $(buttonAction).attr(\"data-action\", action);\n        $(\".actionbtnlabel.active\").removeClass(\"active\");\n        $('.actionbtnlabel[data-action=\"' + action + '\"').addClass(\"active\");\n        $(buttonAction).removeAttr(\"disabled\");\n        if (disablebtn) {\n            $(buttonAction).attr(\"disabled\", \"disabled\");\n        }\n    };\n\n    const performAction = (action, redirect = false) => {\n\n        var arr = [];\n        arr[\"action\"] = action;\n\n        $(inputFieldsSelector).each(function(index) {\n            var name = $(this).attr(\"name\");\n            var val = $(this).val();\n            if (name === \"pagelist\") {\n                return;\n            }\n            arr[name] = val;\n        });\n\n        Ajax.call([{\n            methodname: 'local_edwiserpagebuilder_perform_page_action',\n            args: Object.assign({}, arr),\n            done: function(response) {\n                // if (response != false && redirect) {\n                //     window.location.replace(response);\n                // }\n            },\n            fail:function() {\n                console.log(\"We have error\");\n            }\n        }]);\n    };\n\n    const registerDynamicFormValidator = () => {\n        $(document).on(\"keyup\", '#pagename[name=\"pagename\"]', function(){\n            let empty = false;\n\n            $('#pagename[name=\"pagename\"]').each(function() {\n                empty = $(this).val().length == 0;\n            });\n\n            if (empty) {\n                $(buttonAction).attr(\"disabled\", \"disabled\");\n            } else {\n                $(buttonAction).removeAttr(\"disabled\");\n            }\n        });\n    };\n\n    const validateForm = () => {\n        var text = $('#pagename[name=\"pagename\"]').val();\n        if (text === \"\" || text == undefined) {\n            alert(\"Page name should not be blank.\");\n            return false;\n        }\n        return true;\n    };\n\n    const load = () => {\n        $(document).ready(function(){\n            registerEvents();\n        });\n    };\n\n    return {\n        load: load\n    };\n});\n"],"names":["define","$","Ajax","Templates","buttonAction","previewModalId","registerEvents","document","on","modalselector","this","attr","remove","removeClass","updateAction","addClass","initForm","validateForm","confirm","performAction","removeAttr","call","methodname","args","done","data","empty","append","html","fail","pageid","renderForPromise","JSON","parse","then","_ref","js","appendNodeContents","registerDynamicFormValidator","console","log","instid","find","undefined","each","jQuery","i","v","val","action","disablebtn","arr","editPageFormId","index","name","Object","assign","response","length","text","alert","load","ready"],"mappings":"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"}