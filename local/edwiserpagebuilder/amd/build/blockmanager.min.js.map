{"version":3,"file":"blockmanager.min.js","sources":["../src/blockmanager.js"],"sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable no-unused-vars */\n/* eslint-disable require-jsdoc */\n/* eslint-disable valid-jsdoc */\n/* eslint-disable */\n\ndefine(['jquery', 'core/ajax', 'core/templates'], function($, Ajax, Templates) {\n    var refaddBlockModalUrl = '';\n    const load = () => {\n        $(document).ready(function() {\n            let addblockbutton = \"#epbaddblockbutton\";\n            let epbcustommodal = \".epb_custom_modal.modal\";\n            let epbclosebutton = epbcustommodal + \" .modal-content .close\";\n            let epbcancelbutton = epbcustommodal + \" .modal-content .cancel\";\n            let epbblockupdatebutton = epbcustommodal + \" .modal-content .blocks-list .card-header .update-content\";\n            let epblayoutupdatebutton = epbcustommodal + \" .modal-content .layout-list .card-header .update-content\";\n\n            let showLayoutsbutton = epbcustommodal + \" .modal-content .show-layouts\";\n            let showBlocksbutton = epbcustommodal + \" .modal-content .show-blocks\";\n            let layoutContainer = epbcustommodal + \" .modal-body .addblock-modal-body.layout-list\";\n            let blockContainer = epbcustommodal + \" .modal-body .addblock-modal-body.blocks-list\";\n\n            let epbupdateblocklistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updateblocklist\";\n            let epbupdatelayoutlistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updatelayoutlist\";\n\n            let epbdeleteblockbtn = blockContainer + \" .card .delete-content\";\n            let epbdeletecardbtn = layoutContainer + \" .card .delete-content\";\n\n            let epblayoutcard = layoutContainer + \" .islayout\";\n\n            $(addblockbutton).on('click', function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(document).on(\"click\", showLayoutsbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"blocklist\").addClass(\"layoutlist\");\n            });\n            $(document).on(\"click\", showBlocksbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"layoutlist\").addClass(\"blocklist\");\n            });\n\n            $(document).on(\"click\", epblayoutcard + \" a\", function(e) {\n                e.preventDefault();\n            });\n\n            $(document).on(\"click\", addblockbutton, function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(epbclosebutton + \",\" + epbcancelbutton).on('click', function() {\n                $(epbcustommodal).addClass('d-none');\n            });\n            $(document).on(\"click\", epbblockupdatebutton, function() {\n                updateBlockContent(this, false);\n            });\n            $(document).on(\"click\", epblayoutupdatebutton, function() {\n                updateBlockContent(this, true);\n            });\n\n            function updateBlockContent(ele, islayout) {\n                $(ele).attr('disabled', true);\n                $(ele).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_update_block_content',\n                    args: {blockname: $(ele).attr(\"data-blockname\"), islayout: islayout},\n                    done: function(data) {\n                        $(ele).find('.fa').removeClass(\"rotate\");\n                        if (data.status == false) {\n                            updateButton(ele);\n                        } else {\n                            $(ele).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(ele).find('.fa').removeClass(\"rotate\");\n                        $(ele).attr('disabled', false);\n                    }\n                }]);\n            }\n            $(document).on(\"click\", epbupdateblocklistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n                var edwpageurl = $(_this).next().val();\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_blocks_list',\n                    args: {\n                        edwpageurl: refaddBlockModalUrl,\n                        contextid: M.cfg.contextid\n                    },\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                            $(blockContainer + ' [data-parentblock=\"edwiseradvancedblock\"]').remove();\n                            $(blockContainer + ' .block-cards').prepend(data.html);\n                            updateButton(_this);\n                        } else {\n                            $(_this).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on(\"click\", epbupdatelayoutlistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_layout_list',\n                    args: {},\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                             $(layoutContainer + ' .block-cards').empty().prepend(data.html);\n                            updateButton(_this);\n                        } else {\n                            $(_this).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on(\"click\", epbdeleteblockbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, false); // False for block\n            });\n\n            $(document).on(\"click\", epbdeletecardbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, true); // True for layout\n            });\n\n            /**\n             * @param id\n             * @param islayout\n             */\n            function delete_content(id, islayout) {\n                Ajax.call([{\n                    methodname: 'local_edwiserpagebuilder_delete_block',\n                    args: {id: id, islayout: islayout},\n                    done: function(data) {\n                        if (islayout) {\n                            var element = layoutContainer;\n                        } else {\n                            var element = blockContainer;\n                        }\n                        $(element).find('.data[data-blockid=\"' + id + '\"]').remove();\n                    },\n                    fail: function(data) {\n                        console.log(\"We are failure\");\n                        console.log(data);\n                    }\n                }]);\n            }\n\n            /**\n             * @param button\n             */\n            function updateButton(button) {\n                $(button).removeClass('btn-primary').addClass('btn-success');\n                $(button).find('.fa').removeClass('fa-refresh').addClass('fa-check');\n                jQuery(button).find('span').html(\"Updated\");\n            }\n\n        });\n    };\n    return {\n        // Init: initialize,\n        load: function(addBlockModalUrl){\n            refaddBlockModalUrl = addBlockModalUrl;\n            load();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","refaddBlockModalUrl","load","document","ready","epbcustommodal","layoutContainer","blockContainer","updateBlockContent","ele","islayout","attr","find","removeClass","addClass","call","methodname","args","blockname","done","data","status","updateButton","fail","delete_content","id","element","remove","console","log","button","jQuery","html","on","epblayoutcard","e","preventDefault","epbclosebutton","this","_this","next","val","edwpageurl","contextid","M","cfg","prepend","empty","addBlockModalUrl"],"mappings":"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"}