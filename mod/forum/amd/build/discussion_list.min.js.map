{"version":3,"sources":["../src/discussion_list.js"],"names":["define","$","Templates","Str","Notification","SubscriptionToggle","Selectors","Repository","PubSub","ForumEvents","registerEventListeners","root","subscribe","SUBSCRIPTION_TOGGLED","data","discussionId","subscribed","subscriptionState","subscribedLabel","find","discussion","item","removeAttr","attr","on","favourite","toggle","toggleElement","forumId","setFavouriteDiscussionState","then","location","reload","catch","exception","pin","e","preventDefault","state","setPinDiscussionState","lock","setDiscussionLockState","context","icon","parents","summary","actions","lockedLabel","locked","removeClass","addClass","forumid","render","html","js","replaceNode","get_string","done","s","addNotification","message","type","init","toggleId","newTargetState","userstate","stringKey","string","closest","text"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module for the list of discussions on when viewing a forum.\n *\n * @module     mod_forum/discussion_list\n * @package    mod_forum\n * @copyright  2019 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/str',\n    'core/notification',\n    'mod_forum/subscription_toggle',\n    'mod_forum/selectors',\n    'mod_forum/repository',\n    'core/pubsub',\n    'mod_forum/forum_events',\n], function(\n    $,\n    Templates,\n    Str,\n    Notification,\n    SubscriptionToggle,\n    Selectors,\n    Repository,\n    PubSub,\n    ForumEvents\n) {\n    var registerEventListeners = function(root) {\n        PubSub.subscribe(ForumEvents.SUBSCRIPTION_TOGGLED, function(data) {\n            var discussionId = data.discussionId;\n            var subscribed = data.subscriptionState;\n            var subscribedLabel = root.find(Selectors.discussion.item + '[data-discussionid= ' + discussionId + '] '\n                + Selectors.discussion.subscribedLabel);\n            if (subscribed) {\n                subscribedLabel.removeAttr('hidden');\n            } else {\n                subscribedLabel.attr('hidden', true);\n            }\n        });\n\n        root.on('click', Selectors.favourite.toggle, function() {\n            var toggleElement = $(this);\n            var forumId = toggleElement.data('forumid');\n            var discussionId = toggleElement.data('discussionid');\n            var subscriptionState = toggleElement.data('targetstate');\n            Repository.setFavouriteDiscussionState(forumId, discussionId, subscriptionState)\n                .then(function() {\n                    return location.reload();\n                })\n                .catch(Notification.exception);\n        });\n\n        root.on('click', Selectors.pin.toggle, function(e) {\n            e.preventDefault();\n            var toggleElement = $(this);\n            var forumId = toggleElement.data('forumid');\n            var discussionId = toggleElement.data('discussionid');\n            var state = toggleElement.data('targetstate');\n            Repository.setPinDiscussionState(forumId, discussionId, state)\n                .then(function() {\n                    return location.reload();\n                })\n                .catch(Notification.exception);\n        });\n\n        root.on('click', Selectors.lock.toggle, function(e) {\n            var toggleElement = $(this);\n            var forumId = toggleElement.data('forumid');\n            var discussionId = toggleElement.data('discussionid');\n            var state = toggleElement.data('state');\n\n            Repository.setDiscussionLockState(forumId, discussionId, state)\n                .then(function(context) {\n                    var icon = toggleElement.parents(Selectors.summary.actions).find(Selectors.lock.icon);\n                    var lockedLabel = toggleElement.parents(Selectors.discussion.item).find(Selectors.discussion.lockedLabel);\n                    if (context.locked) {\n                        icon.removeClass('hidden');\n                        lockedLabel.removeAttr('hidden');\n                    } else {\n                        icon.addClass('hidden');\n                        lockedLabel.attr('hidden', true);\n                    }\n                    return context;\n                })\n                .then(function(context) {\n                    context.forumid = forumId;\n                    return Templates.render('mod_forum/discussion_lock_toggle', context);\n                })\n                .then(function(html, js) {\n                    return Templates.replaceNode(toggleElement, html, js);\n                })\n                .then(function() {\n                    return Str.get_string('lockupdated', 'forum')\n                        .done(function(s) {\n                            return Notification.addNotification({\n                                message: s,\n                                type: \"info\"\n                            });\n                        });\n                })\n                .catch(Notification.exception);\n\n            e.preventDefault();\n        });\n    };\n\n    return {\n        init: function(root) {\n            SubscriptionToggle.init(root, false, function(toggleElement, context) {\n                var toggleId = toggleElement.attr('id');\n                var newTargetState = context.userstate.subscribed ? 0 : 1;\n                toggleElement.data('targetstate', newTargetState);\n\n                var stringKey = context.userstate.subscribed ? 'unsubscribediscussion' : 'subscribediscussion';\n                return Str.get_string(stringKey, 'mod_forum')\n                    .then(function(string) {\n                        toggleElement.closest('td').find('label[for=\"' + toggleId + '\"]').text(string);\n                        return string;\n                    });\n            });\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"discussion_list.min.js"}