define ("core/tag",["jquery","core/ajax","core/templates","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,f,g,h){return{initTagindexPage:function initTagindexPage(){a("body").delegate(".tagarea[data-ta] a[data-quickload=1]","click",function(d){d.preventDefault();var e=a(this),f=e[0].search.replace(/^\?/,""),g=e.closest(".tagarea[data-ta]"),h=f.split("&").reduce(function(a,b){var c=b.split("=");a[c[0]]=decodeURIComponent(c[1]);return a},{}),i=b.call([{methodname:"core_tag_get_tagindex",args:{tagindex:h}}],!0);a.when.apply(a,i).done(function(a){c.render("core_tag/index",a).done(function(a){g.replaceWith(a)})})})},initManagePage:function initManagePage(){a("body").on("updated","[data-inplaceeditable]",function(b){f.get_string("selecttag","core_tag",b.ajaxreturn.value).then(function(c){return a("label[for=\"tagselect"+b.ajaxreturn.itemid+"\"]").html(c)}).fail(d.exception);f.get_string("now").done(function(c){a(b.target).closest("tr").find("td.col-timemodified").html(c)});if("tagflag"===b.ajaxreturn.itemtype){var c=a(b.target).closest("tr");if("0"===b.ajaxreturn.value){c.removeClass("flagged-tag")}else{c.addClass("flagged-tag")}}});a(".tag-management-table").delegate("a.tagdelete","click",function(b){b.preventDefault();var c=a(this).attr("href");f.get_strings([{key:"delete"},{key:"confirmdeletetag",component:"tag"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=c})})});a("#tag-management-delete").click(function(b){var c=a(this).closest("form").get(0),e=a(c).find("input[type=checkbox]:checked").length;if(!e){return}var g=a("<input type='hidden'/>").attr("name",this.name);b.preventDefault();f.get_strings([{key:"delete"},{key:"confirmdeletetags",component:"tag"},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){g.appendTo(c);c.submit()})})});a("#tag-management-combine").click(function(b){b.preventDefault();var i=a(this).closest("form").get(0),j=a(i).find("input[type=checkbox]:checked");if(1>=j.length){f.get_strings([{key:"combineselected",component:"tag"},{key:"selectmultipletags",component:"tag"},{key:"ok"}]).done(function(a){d.alert(a[0],a[1],a[2])});return}var k=a("<input type='hidden'/>").attr("name",this.name),l="",m=[];j.each(function(){var b=a(this).val(),c=a(".inplaceeditable[data-itemtype=tagname][data-itemid="+b+"]").attr("data-value");m.push({id:b,name:c})});f.get_strings([{key:"combineselected",component:"tag"},{key:"continue"}]).then(function(a){var b=a[0];l=a[1];return g.create({title:b,body:c.render("core_tag/combine_tags",{tags:m}),type:g.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(l);b.getRoot().on(h.save,function(b){b.preventDefault();k.appendTo(i);var c=a("input[name=maintag]:checked","#combinetags_form").val();a("<input type='hidden'/>").attr("name","maintag").attr("value",c).appendTo(i);i.submit()});b.getRoot().on(h.hidden,function(){b.destroy()});b.show();a("#combinetags_form input[type=radio]").first().focus().prop("checked",!0)}).catch(d.exception)});a("body").on("updatefailed","[data-inplaceeditable][data-itemtype=tagname]",function(b){var c=b.exception,e=b.newvalue,g=a(b.target).attr("data-itemid");if("namesalreadybeeingused"===c.errorcode){b.preventDefault();f.get_strings([{key:"nameuseddocombine",component:"tag"},{key:"yes"},{key:"cancel"}]).done(function(a){d.confirm(b.message,a[0],a[1],a[2],function(){window.location.href=window.location.href+"&newname="+encodeURIComponent(e)+"&tagid="+encodeURIComponent(g)+"&action=renamecombine&sesskey="+M.cfg.sesskey})})}});a("body").on("click","a[data-action=addstandardtag]",function(b){b.preventDefault();var e="";f.get_strings([{key:"addotags",component:"tag"},{key:"continue"}]).then(function(a){var b=a[0];e=a[1];var d={actionurl:window.location.href,sesskey:M.cfg.sesskey};return g.create({title:b,body:c.render("core_tag/add_tags",d),type:g.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(e);b.getRoot().on(h.save,function(b){var c=a(b.currentTarget).find("#id_tagslist"),d=c.val().trim();c.val(d);var e=a("#addtags_form");e.on("submit",function(b){var c=a("#addtags_form");if(!1===c[0].checkValidity()){b.preventDefault();b.stopPropagation()}c.addClass("was-validated");a("[data-region=\"tagslistinput\"]").addClass("error");var d=a("#id_tagslist_error_message");d.removeAttr("hidden");d.addClass("help-block")});e.submit();return!1});b.getRoot().on(h.hidden,function(){b.destroy()});b.show()}).catch(d.exception)})},initManageCollectionsPage:function initManageCollectionsPage(){a("body").on("updated","[data-inplaceeditable]",function(b){var c=b.ajaxreturn,d,e,f;if("core_tag"===c.component&&"tagareaenable"===c.itemtype){d=a(this).attr("data-itemid");a(".tag-collections-table ul[data-collectionid] li[data-areaid="+d+"]").hide();f=c.value;if("1"===f){a(this).closest("tr").removeClass("dimmed_text");e=a(this).closest("tr").find("[data-itemtype=\"tagareacollection\"]").attr("data-value");a(".tag-collections-table ul[data-collectionid="+e+"] li[data-areaid="+d+"]").show()}else{a(this).closest("tr").addClass("dimmed_text")}}if("core_tag"===c.component&&"tagareacollection"===c.itemtype){d=a(this).attr("data-itemid");a(".tag-collections-table ul[data-collectionid] li[data-areaid="+d+"]").hide();e=a(this).attr("data-value");f=a(this).closest("tr").find("[data-itemtype=\"tagareaenable\"]").attr("data-value");if("1"===f){a(".tag-collections-table ul[data-collectionid="+e+"] li[data-areaid="+d+"]").show()}}});a("body").on("click",".addtagcoll > a",function(b){b.preventDefault();var e=a(this).attr("data-url"),i="";f.get_strings([{key:"addtagcoll",component:"tag"},{key:"create"}]).then(function(a){var b=a[0];i=a[1];var d={actionurl:e,sesskey:M.cfg.sesskey};return g.create({title:b,body:c.render("core_tag/add_tag_collection",d),type:g.types.SAVE_CANCEL})}).then(function(b){b.setSaveButtonText(i);b.getRoot().on(h.save,function(b){var c=a(b.currentTarget).find("#addtagcoll_name"),d=c.val().trim();c.val(d);var f=a("#addtagcoll_form");f.on("submit",function(b){if(!1===f[0].checkValidity()){b.preventDefault();b.stopPropagation()}f.addClass("was-validated");a("[data-region=\"addtagcoll_nameinput\"]").addClass("error");var c=a("#id_addtagcoll_name_error_message");c.removeAttr("hidden");c.addClass("help-block")});f.submit();return!1});b.getRoot().on(h.hidden,function(){b.destroy()});b.show()}).catch(d.exception)});a("body").on("click",".tag-collections-table .action_delete",function(b){b.preventDefault();var c=a(this).attr("data-url")+"&sesskey="+M.cfg.sesskey;f.get_strings([{key:"delete"},{key:"suredeletecoll",component:"tag",param:a(this).attr("data-collname")},{key:"yes"},{key:"no"}]).done(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){window.location.href=c})})})}}});
//# sourceMappingURL=tag.min.js.map
