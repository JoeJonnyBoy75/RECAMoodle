/**
 * Theme customizer menu js
 * @copyright (c) 2021 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author    Yogesh Shirsath
 */
define("theme_remui/customizer/elements/menu",["jquery","core/notification","core/templates","core/modal_factory","core/modal_events","core/modal_save_cancel"],(function($,Notification,Templates,ModalFactory,ModalEvents){let SELECTOR_ADDMENUITEM=".add-menu-item",SELECTOR_EDITMENUITEM=".action-edit",SELECTOR_MOVEUPMENUITEM=".action-move-up",SELECTOR_MOVEDOWNMENUITEM=".action-move-down",SELECTOR_DELETEMENUITEM=".action-delete",SELECTOR_FORM=".customizer-menu-item-form",SELECTOR_TEXT=".menu-text",SELECTOR_ADDRESS=".menu-address",SELECTOR_MENULIST=".customizer-menu-item-list",SELECTOR_MENUITEM=".menu-item",SELECTOR_MENURESET=".menu-reset",DIRECTION_UP=-1,DIRECTION_DOWN=1;function generateMenuData(root){let elements=$(root).find(SELECTOR_MENULIST).find(SELECTOR_MENUITEM),menu=[];$.each(elements,(function(index,element){menu.push({text:$(element).data("text"),address:$(element).data("address")})})),$(root).find("textarea").val(JSON.stringify(menu)).trigger("change")}function regenerateMenu(root,menu){if(null==menu){$(root).find(SELECTOR_MENULIST).html("").hide(),menu=$(root).find("textarea").val();try{menu=JSON.parse(menu)}catch(exception){menu=[]}}0!=menu.length?Templates.render("theme_remui/customizer/elements/menu/menu-item",menu.shift()).done((function(html,js){Templates.appendNodeContents($(root).find(SELECTOR_MENULIST),html,js),regenerateMenu(root,menu)})):$(root).find(SELECTOR_MENULIST).show()}function addEditMenuItem(root,item){let menuitem={};null!=item&&(menuitem={text:$(item).data("text"),address:$(item).data("address")}),ModalFactory.create({title:M.util.get_string("customizermenuadd","theme_remui"),body:Templates.render("theme_remui/customizer/elements/menu/menu-add-edit",menuitem),type:ModalFactory.types.SAVE_CANCEL},$("#create")).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.save,(function(event){event.preventDefault();let text=$(SELECTOR_FORM).find(SELECTOR_TEXT).val(),address=$(SELECTOR_FORM).find(SELECTOR_ADDRESS).val();menuitem={text:text,address:address},Templates.render("theme_remui/customizer/elements/menu/menu-item",menuitem).done((function(html,js){null==item?Templates.appendNodeContents($(root).find(SELECTOR_MENULIST),html,js):Templates.replaceNode($(item),html,js),generateMenuData(root)})),modal.hide()})),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()}))}))}function moveMenuItem(root,item,direction){switch(direction){case DIRECTION_UP:if(0==$(item).prev().length)return;$(item).prev().insertAfter(item);break;case DIRECTION_DOWN:if(0==$(item).next().length)return;$(item).next().insertBefore(item)}generateMenuData(root)}return{init:function(root){$("body").on("click",root+" "+SELECTOR_ADDMENUITEM,(function(){addEditMenuItem(root)})),$("body").on("click",root+" "+SELECTOR_EDITMENUITEM,(function(){addEditMenuItem(root,$(this).closest(SELECTOR_MENUITEM))})),$("body").on("click",root+" "+SELECTOR_MOVEUPMENUITEM,(function(){moveMenuItem(root,$(this).closest(SELECTOR_MENUITEM),DIRECTION_UP)})),$("body").on("click",root+" "+SELECTOR_MOVEDOWNMENUITEM,(function(){moveMenuItem(root,$(this).closest(SELECTOR_MENUITEM),DIRECTION_DOWN)})),$("body").on("click",root+" "+SELECTOR_DELETEMENUITEM,(function(){$(this).closest(SELECTOR_MENUITEM).remove(),generateMenuData(root)})),$("body").on("click",root+" "+SELECTOR_MENURESET,(function(){let value=$(this).data("default");$(this).next().find("textarea").val(JSON.stringify(value)).trigger("input").trigger("change"),regenerateMenu(root)}))}}}));

//# sourceMappingURL=menu.min.js.map