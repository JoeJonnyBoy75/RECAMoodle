{"version":3,"file":"menu.min.js","sources":["../../../src/customizer/elements/menu.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * Theme customizer menu js\n * @copyright (c) 2021 WisdmLabs (https://wisdmlabs.com/) <support@wisdmlabs.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    Yogesh Shirsath\n */\n\ndefine('theme_remui/customizer/elements/menu', [\n    'jquery',\n    'core/notification',\n    'core/templates',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/modal_save_cancel'\n], function($, Notification, Templates, ModalFactory, ModalEvents) {\n\n    /**\n     * Selectors.\n     */\n    let SELECTOR = {\n        ADDMENUITEM: '.add-menu-item',\n        EDITMENUITEM: '.action-edit',\n        MOVEUPMENUITEM: '.action-move-up',\n        MOVEDOWNMENUITEM: '.action-move-down',\n        DELETEMENUITEM: '.action-delete',\n        FORM: '.customizer-menu-item-form',\n        TEXT: '.menu-text',\n        ADDRESS: '.menu-address',\n        MENULIST: '.customizer-menu-item-list',\n        MENUITEM: '.menu-item',\n        MENURESET: '.menu-reset'\n    };\n\n    /**\n     * Menu item move direction.\n     */\n    let DIRECTION = {\n        UP: -1,\n        DOWN: 1\n    };\n\n    /**\n     * Generate json data of menu.\n     * @param {String} root Menu root setting element\n     */\n    function generateMenuData(root) {\n        let elements = $(root).find(SELECTOR.MENULIST).find(SELECTOR.MENUITEM);\n        let menu = [];\n        $.each(elements, function(index, element) {\n            menu.push({\n                'text': $(element).data('text'),\n                'address': $(element).data('address')\n            });\n        });\n        $(root).find('textarea').val(JSON.stringify(menu)).trigger('change');\n    }\n\n    /**\n     * Regenerate menu.\n     * @param {String} root Menu root setting element\n     * @param {String} menu Menu items list\n     */\n    function regenerateMenu(root, menu) {\n        if (menu == undefined) {\n            $(root).find(SELECTOR.MENULIST).html('').hide();\n            menu = $(root).find('textarea').val();\n            try {\n                menu = JSON.parse(menu);\n            } catch (exception) {\n                menu = [];\n            }\n        }\n        if (menu.length == 0) {\n            $(root).find(SELECTOR.MENULIST).show();\n            return;\n        }\n        Templates.render('theme_remui/customizer/elements/menu/menu-item', menu.shift())\n        .done(function(html, js) {\n            Templates.appendNodeContents($(root).find(SELECTOR.MENULIST), html, js);\n            regenerateMenu(root, menu);\n        });\n    }\n\n    /**\n     * Add menu item\n     * @param {String} root Menu root setting element\n     * @param {DOM} item Pass menu item if editing existing menu\n     */\n    function addEditMenuItem(root, item) {\n        let menuitem = {};\n        if (item != undefined) {\n            menuitem = {\n                'text': $(item).data('text'),\n                'address': $(item).data('address')\n            };\n        }\n        ModalFactory.create({\n            title: M.util.get_string('customizermenuadd', 'theme_remui'),\n            body: Templates.render('theme_remui/customizer/elements/menu/menu-add-edit', menuitem),\n            type: ModalFactory.types.SAVE_CANCEL\n        }, $('#create'))\n        .done(function(modal) {\n            modal.show();\n            modal.getRoot().on(ModalEvents.save, function(event) {\n                event.preventDefault();\n                let text = $(SELECTOR.FORM).find(SELECTOR.TEXT).val();\n                let address = $(SELECTOR.FORM).find(SELECTOR.ADDRESS).val();\n                menuitem = {\n                    'text': text,\n                    'address': address\n                };\n                Templates.render('theme_remui/customizer/elements/menu/menu-item', menuitem)\n                .done(function(html, js) {\n                    if (item == undefined) {\n                        Templates.appendNodeContents($(root).find(SELECTOR.MENULIST), html, js);\n                    } else {\n                        Templates.replaceNode($(item), html, js);\n                    }\n                    generateMenuData(root);\n                });\n                modal.hide();\n            });\n\n            // Destroy modal on hidden.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n        });\n    }\n\n    /**\n     * Move menu item up or down\n     * @param {DOM}     root      Menu root setting element\n     * @param {DOM}     item      Menu item\n     * @param {Integer} direction Direction to move item\n     */\n    function moveMenuItem(root, item, direction) {\n        switch (direction) {\n            case DIRECTION.UP:\n                if ($(item).prev().length == 0) {\n                    return;\n                }\n                $(item).prev().insertAfter(item);\n                break;\n            case DIRECTION.DOWN:\n                if ($(item).next().length == 0) {\n                    return;\n                }\n                $(item).next().insertBefore(item);\n                break;\n        }\n        generateMenuData(root);\n    }\n\n    /**\n     * Initialize menu element\n     * @param {String} root Menu root setting element\n     */\n    function init(root) {\n        // Add menu item.\n        $('body').on('click', root + ' ' + SELECTOR.ADDMENUITEM, function() {\n            addEditMenuItem(root);\n        });\n\n        // Edit menu item.\n        $('body').on('click', root + ' ' + SELECTOR.EDITMENUITEM, function() {\n            addEditMenuItem(root, $(this).closest(SELECTOR.MENUITEM));\n        });\n\n        // Move up menu item.\n        $('body').on('click', root + ' ' + SELECTOR.MOVEUPMENUITEM, function() {\n            moveMenuItem(root, $(this).closest(SELECTOR.MENUITEM), DIRECTION.UP);\n        });\n\n        // Move down menu item.\n        $('body').on('click', root + ' ' + SELECTOR.MOVEDOWNMENUITEM, function() {\n            moveMenuItem(root, $(this).closest(SELECTOR.MENUITEM), DIRECTION.DOWN);\n        });\n\n        // Delete menu item.\n        $('body').on('click', root + ' ' + SELECTOR.DELETEMENUITEM, function() {\n            $(this).closest(SELECTOR.MENUITEM).remove();\n            generateMenuData(root);\n        });\n\n        $('body').on('click', root + ' ' + SELECTOR.MENURESET, function() {\n            let value = $(this).data('default');\n            $(this).next().find('textarea').val(JSON.stringify(value)).trigger('input').trigger('change');\n            regenerateMenu(root);\n        });\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Notification","Templates","ModalFactory","ModalEvents","SELECTOR","DIRECTION","generateMenuData","root","elements","find","menu","each","index","element","push","data","val","JSON","stringify","trigger","regenerateMenu","undefined","html","hide","parse","exception","length","render","shift","done","js","appendNodeContents","show","addEditMenuItem","item","menuitem","create","title","M","util","get_string","body","type","types","SAVE_CANCEL","modal","getRoot","on","save","event","preventDefault","text","address","replaceNode","hidden","destroy","moveMenuItem","direction","prev","insertAfter","next","insertBefore","init","this","closest","remove","value"],"mappings":";;;;;;AAqBAA,8CAA+C,CAC3C,SACA,oBACA,iBACA,qBACA,oBACA,2BACD,SAASC,EAAGC,aAAcC,UAAWC,aAAcC,iBAK9CC,qBACa,iBADbA,sBAEc,eAFdA,wBAGgB,kBAHhBA,0BAIkB,oBAJlBA,wBAKgB,iBALhBA,cAMM,6BANNA,cAOM,aAPNA,iBAQS,gBARTA,kBASU,6BATVA,kBAUU,aAVVA,mBAWW,cAMXC,cACK,EADLA,eAEM,WAODC,iBAAiBC,UAClBC,SAAWT,EAAEQ,MAAME,KAAKL,mBAAmBK,KAAKL,mBAChDM,KAAO,GACXX,EAAEY,KAAKH,UAAU,SAASI,MAAOC,SAC7BH,KAAKI,KAAK,MACEf,EAAEc,SAASE,KAAK,gBACbhB,EAAEc,SAASE,KAAK,gBAGnChB,EAAEQ,MAAME,KAAK,YAAYO,IAAIC,KAAKC,UAAUR,OAAOS,QAAQ,mBAQtDC,eAAeb,KAAMG,SACdW,MAARX,KAAmB,CACnBX,EAAEQ,MAAME,KAAKL,mBAAmBkB,KAAK,IAAIC,OACzCb,KAAOX,EAAEQ,MAAME,KAAK,YAAYO,UAE5BN,KAAOO,KAAKO,MAAMd,MACpB,MAAOe,WACLf,KAAO,IAGI,GAAfA,KAAKgB,OAITzB,UAAU0B,OAAO,iDAAkDjB,KAAKkB,SACvEC,MAAK,SAASP,KAAMQ,IACjB7B,UAAU8B,mBAAmBhC,EAAEQ,MAAME,KAAKL,mBAAoBkB,KAAMQ,IACpEV,eAAeb,KAAMG,SANrBX,EAAEQ,MAAME,KAAKL,mBAAmB4B,gBAe/BC,gBAAgB1B,KAAM2B,UACvBC,SAAW,GACHd,MAARa,OACAC,SAAW,MACCpC,EAAEmC,MAAMnB,KAAK,gBACVhB,EAAEmC,MAAMnB,KAAK,aAGhCb,aAAakC,OAAO,CAChBC,MAAOC,EAAEC,KAAKC,WAAW,oBAAqB,eAC9CC,KAAMxC,UAAU0B,OAAO,qDAAsDQ,UAC7EO,KAAMxC,aAAayC,MAAMC,aAC1B7C,EAAE,YACJ8B,MAAK,SAASgB,OACXA,MAAMb,OACNa,MAAMC,UAAUC,GAAG5C,YAAY6C,MAAM,SAASC,OAC1CA,MAAMC,qBACFC,KAAOpD,EAAEK,eAAeK,KAAKL,eAAeY,MAC5CoC,QAAUrD,EAAEK,eAAeK,KAAKL,kBAAkBY,MACtDmB,SAAW,MACCgB,aACGC,SAEfnD,UAAU0B,OAAO,iDAAkDQ,UAClEN,MAAK,SAASP,KAAMQ,IACLT,MAARa,KACAjC,UAAU8B,mBAAmBhC,EAAEQ,MAAME,KAAKL,mBAAoBkB,KAAMQ,IAEpE7B,UAAUoD,YAAYtD,EAAEmC,MAAOZ,KAAMQ,IAEzCxB,iBAAiBC,SAErBsC,MAAMtB,UAIVsB,MAAMC,UAAUC,GAAG5C,YAAYmD,QAAQ,WACnCT,MAAMU,yBAWTC,aAAajD,KAAM2B,KAAMuB,kBACtBA,gBACCpD,gBAC4B,GAAzBN,EAAEmC,MAAMwB,OAAOhC,cAGnB3B,EAAEmC,MAAMwB,OAAOC,YAAYzB,iBAE1B7B,kBAC4B,GAAzBN,EAAEmC,MAAM0B,OAAOlC,cAGnB3B,EAAEmC,MAAM0B,OAAOC,aAAa3B,MAGpC5B,iBAAiBC,YAyCd,CACHuD,cAnCUvD,MAEVR,EAAE,QAAQgD,GAAG,QAASxC,KAAO,IAAMH,sBAAsB,WACrD6B,gBAAgB1B,SAIpBR,EAAE,QAAQgD,GAAG,QAASxC,KAAO,IAAMH,uBAAuB,WACtD6B,gBAAgB1B,KAAMR,EAAEgE,MAAMC,QAAQ5D,uBAI1CL,EAAE,QAAQgD,GAAG,QAASxC,KAAO,IAAMH,yBAAyB,WACxDoD,aAAajD,KAAMR,EAAEgE,MAAMC,QAAQ5D,mBAAoBC,iBAI3DN,EAAE,QAAQgD,GAAG,QAASxC,KAAO,IAAMH,2BAA2B,WAC1DoD,aAAajD,KAAMR,EAAEgE,MAAMC,QAAQ5D,mBAAoBC,mBAI3DN,EAAE,QAAQgD,GAAG,QAASxC,KAAO,IAAMH,yBAAyB,WACxDL,EAAEgE,MAAMC,QAAQ5D,mBAAmB6D,SACnC3D,iBAAiBC,SAGrBR,EAAE,QAAQgD,GAAG,QAASxC,KAAO,IAAMH,oBAAoB,eAC/C8D,MAAQnE,EAAEgE,MAAMhD,KAAK,WACzBhB,EAAEgE,MAAMH,OAAOnD,KAAK,YAAYO,IAAIC,KAAKC,UAAUgD,QAAQ/C,QAAQ,SAASA,QAAQ,UACpFC,eAAeb"}