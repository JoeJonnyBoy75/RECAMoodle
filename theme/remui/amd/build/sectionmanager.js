define(["exports","jquery","core/ajax","core/templates","core/notification","theme_remui/notice","theme_remui/events"],function(e,t,i,n,a,o,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var d=h(t),l=h(i),r=h(n),c=h(a),u=h(o),f=h(s);function h(e){return e&&e.__esModule?e:{default:e}}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=(function(e,t,i){return t&&v(e.prototype,t),i&&v(e,i),e}(p,[{key:"setLoadedSection",value:function(e,t){y[e]=t}},{key:"getLoadedSection",value:function(e){return y[e]}},{key:"setSectionName",value:function(e){this.name=e}},{key:"setInstanceid",value:function(e){this.instanceid=e,g='section[data-instance="'+e+'"]'}},{key:"templateprefixer",value:function(e){return this.templateprefix+e}},{key:"activateLoader",value:function(e){e=this.getJsonParsedData(e);var t=function(){this.setInstanceid(e.id),this.saveSectionsOrder(),(0,d.default)("body").trigger("scroll"),this.scrollToSection('section[data-instance="'+e.id+'"]')}.bind(this);this.renderTemplate(this.templateprefixer(e.sectionname),e,this.sectioncontainer,t)}},{key:"scrollToSection",value:function(e){var t=(0,d.default)(e).offset().top-65;(0,d.default)("html, body").animate({scrollTop:t},1e3)}},{key:"renderTemplate",value:function(e,i,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;r.default.render(e,i).then(function(e,t){r.default.appendNodeContents(n,e,t),(0,d.default)("body").trigger({type:f.default.SECTION_ADDED,configdata:i}),null!=a&&a()})}},{key:"getSectionElement",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return!1!==e&&this.setInstanceid(e),(0,d.default)("body").find(g)}},{key:"playSliderVideo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this.getSectionElement(e);t.find(".carousel-item:not(.active) video").each(function(e,t){t.pause()}),t.find(".carousel-item.active video").each(function(e,t){t.play()})}},{key:"renderTemplates",value:function(i,n){var e=i.pop(),t=this.getJsonParsedData(e);this.setLoadedSection(t.id,e),t.lazyloading=!0,r.default.render("theme_remui/hs_common",t).done(function(e,t){e=(0,d.default)(e).height(window.innerHeight+"px"),r.default.appendNodeContents(n,e,t),0==appearanimation&&(0,d.default)("body").trigger("scroll"),this.hideAllSectionsLoader(),0!=i.length&&this.renderTemplates(i,n)}.bind(this)).fail(function(e){this.hideAllSectionsLoader(),c.default.exception(e)}.bind(this))}},{key:"getJsonParsedData",value:function(e){return JSON.parse(e)}},{key:"addSection",value:function(){l.default.call([{methodname:"theme_remui_create_section_instance",args:{sectionname:this.name},done:this.activateLoader.bind(this),fail:c.default.exception}])}},{key:"hideAllSectionsLoader",value:function(){(0,d.default)(".sections-loader-wrapper").removeClass("show"),setTimeout(function(){(0,d.default)(".sections-loader-wrapper").hide(),(0,d.default)(window).trigger("scroll")},300)}},{key:"showAllSectionsLoader",value:function(){(0,d.default)(".sections-loader-wrapper").addClass("show").css("display","block")}},{key:"showSectionLoader",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];(0,d.default)('.section-loader-wrapper[data-instance="'+e+'"]').toggleClass("d-none",!t)}},{key:"addAllSections",value:function(e){e.sections.reverse(),0!=e.sections.length?(jQuery("html, body").animate({scrollTop:0},jQuery(window).scrollTop()/6),this.renderTemplates(e.sections,this.sectioncontainer)):this.hideAllSectionsLoader()}},{key:"LoadAllSections",value:function(){l.default.call([{methodname:"theme_remui_fetch_all_instances",args:{},done:this.addAllSections.bind(this),fail:c.default.exception}])}},{key:"reloadSection",value:function(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(0!=e.success){var n=JSON.parse(e.context);this.setInstanceid(n.id);var a=(0,d.default)(g);r.default.render(this.templateprefixer(n.sectionname),n).done(function(e,t){e=(0,d.default)(e),0==appearanimation&&(0,d.default)(e).removeClass("invisible"),r.default.replaceNode(a,e,t),(0,d.default)("body").trigger({type:f.default.SECTION_UPDATED,configdata:n}),"slider"==n.sectionname&&this.playSliderVideo(n.id),(0,d.default)("body").trigger("scroll"),null!=i&&i()}.bind(this)).fail(function(e){this.showSectionLoader(this.instanceid,!1),c.default.exception(e)}.bind(this))}}},{key:"updateSection",value:function(t,e){this.showSectionLoader(t),l.default.call([{methodname:"theme_remui_update_section_instance",args:{instanceid:t,jsonformdata:e},done:function(e){u.default.success(M.util.get_string("sectionupdated","theme_remui"),4e3),this.reloadSection(e)}.bind(this),fail:function(e){this.showSectionLoader(t,!1),c.default.exception(e)}.bind(this)}])}},{key:"deletionTimer",value:function(t,e){0==e&&clearInterval(S[t]);var i=this.getSectionElement(),n=(0,d.default)(i).find(".cancel-delete-section .section-deletion-timer");S[t]=setInterval(function(){var e=parseInt((0,d.default)(n).text())-1;(0,d.default)(n).text(e),0==e&&(clearInterval(S[t]),(0,d.default)(i).remove(),this.saveSectionsOrder(),(0,d.default)("body").trigger("scroll"))}.bind(this),1e3)}},{key:"deleteInstance",value:function(t){var i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(this.showSectionLoader(t,!0),this.setInstanceid(t),2==i)return this.deletionTimer(t,!1),this.getSectionElement().remove(),this.saveSectionsOrder(),void(0,d.default)("body").trigger("scroll");1==i&&u.default.success(M.util.get_string("sectiondeleted","theme_remui"),4e3),l.default.call([{methodname:"theme_remui_delete_section_instance",args:{instanceid:t,action:i},done:function(e){this.reloadSection(e,function(){this.deletionTimer(t,i)}.bind(this)),this.saveSectionsOrder()}.bind(this),fail:function(e){this.showSectionLoader(t,!1),c.default.exception(e)}.bind(this)}])}},{key:"getSectionsOrder",value:function(){var e=(0,d.default)("body").find("section[data-instance]"),i=[];return e.each(function(e,t){(0,d.default)(t).find(".section-delete-overlay")&&i.push((0,d.default)(t).data("instance"))}),i}},{key:"saveSectionsOrder",value:function(){transparentheader&&(0,d.default)("body").toggleClass("has-slider animate-header",(0,d.default)("body").find("section[data-instance]:first-child").is(".section-slider"));var e=this.getSectionsOrder();return l.default.call([{methodname:"theme_remui_save_sections_order",args:{order:e}}])[0]}},{key:"reorderSection",value:function(t,i){var e=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];this.setInstanceid(t);var n=(0,d.default)(g);if(-1!=i||n.is(":first-child")){if(1!=i||n.is(":last-child"))return;n.next().insertBefore(n)}else n.prev().insertAfter(n);0!=e&&this.saveSectionsOrder().fail(function(e){c.default.exception(e),this.reorderSection(t,-1*i,!1)}.bind(this))}},{key:"updateVisibility",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.getSectionElement(e).find("button.section-visibility");l.default.call([{methodname:"theme_remui_update_section_visibility",args:{id:e,visible:t},done:function(e){(0,d.default)(i).data("visible",t),(0,d.default)(i).find(".icon").toggleClass("fa-eye",t),(0,d.default)(i).find(".icon").toggleClass("fa-eye-slash",!t),t?((0,d.default)(i).attr("title","Hide"),(0,d.default)(i).find(".icon").attr("title","Hide")):((0,d.default)(i).attr("title","Show"),(0,d.default)(i).find(".icon").attr("title","Show"))}.bind(this),fail:c.default.exception}])}}]),p);function p(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),this.sectioncontainer="#page-site-index .home-sections",this.templateprefix="theme_remui/hs_"}var g="",y=[],S=[];e.init=function(){return new m}});