define(["jquery","theme_remui/bootstrap-select","core/templates","theme_remui/jquery-toolbar"],function(o,e,c,t){var l,a=o("select#sortfilter.selectpicker"),s=(o(".togglebtn"),o("#coursesearch2")),r=o("select#categoryfilter.selectpicker"),i=(o(".nav-tabs .nav-item"),o("#coursestab")),n=o("#mycoursestab"),u=o("#coursesregion div.content"),d=o("#mycoursesregion div.content"),g=o("#coursespagination"),p=o("#mycoursespagination"),f=o(".togglebtn"),v="theme_remui/course_card_grid",b="theme_remui/course_card_list";function h(){l.isFilterModified&&function(){$(".courses-tabs .courses-loader-wrap").show();var i=l.tab?d:u,n=l.tab?p:g;o.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/remui/request_handler.php?action=get_courses_ajax&wdmdata="+JSON.stringify(l)+"&sesskey="+M.cfg.sesskey,success:function(a){var e=null==l.view?a.view:l.view,t="grid"==e||a.latest_card?v:b;(window.screen.width<=480||a.latest_card)&&(t=v,e="grid"),function(e){"grid"==e?(l.view="grid",o(".tab-content").addClass("grid-view").removeClass("list-view"),o(".grid_btn").addClass("btn-primary active"),o(".list_btn").removeClass("btn-primary active")):(l.view="list",o(".tab-content").addClass("list-view").removeClass("grid-view"),o(".grid_btn").removeClass("btn-primary active"),o(".list_btn").addClass("btn-primary active"))}(e),function(e){e?(o(".tab-content").addClass("latest-cards"),o(".viewtoggler").addClass("hidden")):(o(".tab-content").removeClass("latest-cards"),o(".viewtoggler").removeClass("hidden"))}(a.latest_card);var s=a.courses;if(0<s.length)for(var r=0;r<s.length;r++)c.render(t,s[r]).then(function(e,t){c.appendNodeContents(i,e,t),l.tab||a.latest_card||o(".showoptions").each(function(){o(this).toolbar({content:o(this).data("toolbar"),style:"primary"})})}).fail(function(e){});else{'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button> No Courses Found</div>',c.appendNodeContents(i,'<div class="alert alert-warning alert-dismissible  w-full mx-10" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button> No Courses Found</div>',"")}l.pagination&&c.appendNodeContents(n,a.pagination,""),$(".courses-tabs .courses-loader-wrap").hide()},error:function(e,t,a){$(".courses-tabs .courses-loader-wrap").show()}})}()}function m(){var e={courses:0,mycourses:0},t={category:"all",sort:null,search:"",tab:!1,page:e,pagination:!0,view:null,isFilterModified:!0,initAttributes:function(){t.category="all",t.sort=null,t.search="",t.tab=!1,t.page=e,t.pagination=!0,t.view=null,t.isFilterModified=!0},initPagination:function(){t.page={courses:0,mycourses:0}}};return t}function y(){!function(){var e=l.tab?d:u;if(o(e).empty(),l.pagination){var t=l.tab?p:g;o(t).empty()}}(),h()}o(document).ready(function(){l=new m;for(var e,t=[],a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),s=0;s<a.length;s++)e=a[s].split("="),t.push(e[0]),t[e[0]]=e[1];t.category&&0!=t.category&&(l.category=t.category),null!=t.categorysort&&(l.sort=t.categorysort),null!=t.search&&(l.search=t.search),t.mycourses&&0!=t.mycourses&&(l.tab=!0),function(e){o(".selectpicker").each(function(){o(this).selectpicker()}),"0"!=e.category&&o("#categoryfilter.selectpicker").selectpicker("val",e.category);null!=e.sort&&o("#sortfilter.selectpicker").selectpicker("val",e.sort);""!=e.sort&&o("#coursesearchbox").val(e.search);o(".category-filters").removeClass("d-none")}(l),h()}),o(document).delegate(".tool-item","click",function(){window.location=o(this).attr("href")}),o(r).on("changed.bs.select",function(e){l.category=e.target.value,l.initPagination(),y()}),o(a).on("changed.bs.select",function(e){l.sort=e.target.value,y()}),o(i).on("click",function(){l.tab=!1,y()}),o(n).on("click",function(){l.tab=!0,y()}),o(s).on("submit",function(e){e.preventDefault(),l.initPagination(),l.search=o("#coursesearchbox").val(),y()}),o(f).on("click",function(){var e=o(this).attr("data-view");l.view=e,M.util.set_user_preference("course_view_state",e,null),y()}),o(document).delegate(".tab-pane .pagination .page-item .page-link","click",function(e){e.preventDefault();for(var t,a=e.target.href.slice(e.target.href.indexOf("?")+1).split("&"),s=[],r=0;r<a.length;r++)t=a[r].split("="),s.push(t[0]),s[t[0]]=t[1];l.tab?l.page.mycourses=s.page:l.page.courses=s.page,y()})});