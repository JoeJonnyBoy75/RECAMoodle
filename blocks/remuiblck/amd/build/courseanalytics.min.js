define ("block_remuiblck/courseanalytics",["jquery","core/ajax","core/chartjs","core/custom_interaction_events","block_remuiblck/events"],function(a,b,c,d,f){var g={PAGECOUNT:"[data-action-page-count]",PAGINATE:"[data-action-paginate]",NEXT:"[data-next]",PREVIOUS:"[data-previous]",CHARTPAGINATION:".analysis-chart-pagination",PAGES:"[data-region-pages]",TOGGLELABELS:"#togglelabels",PER_PAGE_FILTER:"[data-region=\"per-page-filter\"]",FILTER_OPTION:"[data-value]"};window.analysisChart=null;var h=1,i=1,j;function k(a){var b={start:0,end:0};if(j.labels==void 0){return b}if(j.labels.length<=a){b.start=1;b.end=j.labels.length;return b}b.start=1==h?1:(h-1)*a+1;b.end=h*a;if(j.labels.length<b.end){b.end=j.labels.length}return b}function l(b,c){var d=k(c);a(b).find(g.PAGES).text(M.util.get_string("showingfromto","block_remuiblck",{start:d.start,to:d.end,total:j.labels.length}));analysisChart.data.labels=[];analysisChart.data.datasets.forEach(function(a){a.data=[]});analysisChart.update();for(var e=d.start-1;e<=d.end;e++){analysisChart.data.labels.push(j.labels[e]);analysisChart.data.datasets.forEach(function(a,b){a.data.push(j.datasets[b].data[e])});analysisChart.update()}}function m(b,c){if(j.labels==void 0){a(b).find(g.CHARTPAGINATION).addClass("d-none");return}h=1;a(b).find(g.CHARTPAGINATION).removeClass("d-none");i=j.labels.length>c?Math.round(j.labels.length/c):1;l(b,c)}function n(c){var d=a(c).find("#coursecategorylist option:selected").data("id");return b.call([{methodname:"block_remuiblck_get_course_analytics",args:{courseid:d}}])[0]}function o(b){n(b).done(function(d){j=d;h=1;if(null!==analysisChart){analysisChart.destroy()}if(d.error){a(b).find("#highestactivity").html("");a(b).find("#lowestactivity").html("");a(b).find("#highestgrade").html("0");a(b).find("#lowestgrade").html("0");a(b).find("#averagegrade").html("0")}else{a(b).find("#highestactivity").html(j.maxactivityname);a(b).find("#lowestactivity").html(j.minactivityname);a(b).find("#highestgrade").html(j.highest);a(b).find("#lowestgrade").html(j.lowest);a(b).find("#averagegrade").html(j.average)}var e=a(b).find("#analysischart").get(0).getContext("2d"),f=[];if(d.datasets!=void 0){d.datasets.forEach(function(a){f.push({data:[],backgroundColor:a.backgroundColor,label:a.label})})}e.canvas.height=400;analysisChart=new c(e,{data:{labels:[],datasets:f},type:"bar",options:{responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!0},hover:{animationDuration:0},layout:{padding:{top:20}},legend:{position:"bottom",labels:{padding:20,fontSize:12}},animation:{duration:300,easing:"easeInOutQuad",onComplete:function onComplete(){var a=this.chart,b=a.ctx;b.font=c.helpers.fontString(c.defaults.global.defaultFontSize,c.defaults.global.defaultFontStyle,c.defaults.global.defaultFontFamily);b.textAlign="center";b.textBaseline="bottom";this.data.datasets.forEach(function(c,d){var e=a.controller.getDatasetMeta(d);if(!0!=e.hidden){e.data.forEach(function(a,d){var e=c.data[d];b.fillText(e,a._model.x,a._model.y-5)})}})}},scales:{xAxes:[{display:!1,gridLines:{display:!0}}],yAxes:[{ticks:{beginAtZero:!0},gridLines:{display:!0}}]}}});m(b,q(b))}).fail(function(){a(b).find("div#analysis-chart-area").hide()})}var p=function(b){var c=a(b).find(g.PER_PAGE_FILTER);d.define(c,[d.events.activate]);c.on(d.events.activate,g.FILTER_OPTION,function(c,d){d.originalEvent.preventDefault();var e=a(c.target).closest(g.FILTER_OPTION);if(e.hasClass("active")){return}a(c.target).trigger(f.COURSE_ANALYTICS_PAGE_FILTER_CHANGE);M.util.set_user_preference("courseanalyticsperpage",e.data("value"));m(b,e.data("value"))})},q=function(b){return a(b).find(g.PER_PAGE_FILTER).find(g.FILTER_OPTION+".active").data("value")};function r(b){p(b);a("body").on("click",b+" "+g.PAGINATE,function(){if(a(this).is(g.NEXT)){if(h==i){return}h++}else if(a(this).is(g.PREVIOUS)){if(1==h){return}h--}else{return}var c=q(b);l(b,c)});a("body").on("change",b+" #coursecategorylist",function(){o(b)})}return{init:function init(b){a(document).ready(function(){r(b);if(a(b).find("#analysischart").length){o(b)}})}}});
//# sourceMappingURL=courseanalytics.min.js.map
