{"version":3,"sources":["../src/quizstats.js"],"names":["define","$","Ajax","SELECTORS","ROOT","CHART","CHART_AREA","COURSE_LIST","QUIZ_LIST","LIST_SELECTED","ERROR","barChart","getStepSize","datasets","max","current","forEach","data","Math","apply","ceil","createBarChart","courseId","getSelectedCourseID","quizId","getSelectedQuizID","call","methodname","args","courseid","quizid","done","response","find","hide","show","destroy","barcontext","get","getContext","canvas","height","barData","labels","Chart","type","options","responsive","maintainAspectRatio","scales","yAxes","scaleLabel","display","labelString","M","util","get_string","ticks","min","stepSize","fail","populateQuizSelector","option","i","length","quizname","empty","append","initEvents","on","init","root","document","ready"],"mappings":"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","sourcesContent":["/* eslint-disable no-undef */\ndefine(['jquery', 'core/ajax', 'core/chartjs'], function($, Ajax) {\n\n    var SELECTORS = {\n        ROOT: null,\n        CHART: \"#barChart\",\n        CHART_AREA: '#quiz-chart-area',\n        COURSE_LIST: '#quiz-course-list',\n        QUIZ_LIST: '#quiz-list',\n        LIST_SELECTED: 'option:selected',\n        ERROR: '.quiz-stats-error'\n    };\n    var barChart = null;\n    var getStepSize = function(datasets) {\n        let max = 0;\n        let current;\n        datasets.forEach(function(data) {\n            current = Math.max.apply(Math, data.data);\n            max = current > max ? current : max;\n        });\n        return Math.ceil(max / 20);\n    };\n    /**\n     *\n     */\n    function createBarChart() {\n        var courseId = getSelectedCourseID();\n        var quizId = getSelectedQuizID();\n\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quiz_participation',\n            args: {\n                courseid: courseId,\n                quizid: quizId\n            }\n        }])[0]\n        .done(function(response) {\n            if (response.datasets === undefined) {\n                $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n                $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n            } else {\n                if (barChart !== null) {\n                    barChart.destroy();\n                }\n                var barcontext = $(SELECTORS.ROOT).find(SELECTORS.CHART).get(0).getContext(\"2d\");\n                barcontext.canvas.height = 400;\n\n                var barData = {\n                    labels: response.labels,\n                    datasets: response.datasets\n                };\n                barChart = new Chart(barcontext, {\n                    type: 'bar',\n                    data: barData,\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        scales: {\n                            yAxes: [{\n                                scaleLabel: {\n                                    display: true,\n                                    labelString: M.util.get_string('noofstudents', 'block_remuiblck')\n                                },\n                                ticks: {\n                                    min: 0,\n                                    stepSize: getStepSize(response.datasets)\n                                }\n                            }]\n                        }\n                    }\n                });\n            }\n        })\n        .fail(function() {\n            $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n            $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n        });\n    }\n\n    var getSelectedCourseID = function() {\n        return $(SELECTORS.ROOT).find(SELECTORS.COURSE_LIST + ' ' + SELECTORS.LIST_SELECTED).data('courseid');\n    };\n    var getSelectedQuizID = function() {\n        return $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST + ' ' + SELECTORS.LIST_SELECTED).data('quizid');\n    };\n    var populateQuizSelector = function() {\n        var courseId = getSelectedCourseID();\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quizzes_of_course',\n            args: {\n                courseid: courseId\n            }\n        }])[0]\n        .done(function(response) {\n            var option = \"\";\n            for (var i = 0; i < response.length; i++) {\n                option = option + \"<option data-id='\" + response[i].courseid + \"' data-quizid='\" + response[i].quizid + \"'>\";\n                option = option + response[i].quizname + \"</option>\";\n            }\n            $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST).empty().append(option);\n            createBarChart();\n        })\n        .fail(function() {\n            $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n            $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n        });\n    };\n    var initEvents = function() {\n        $(SELECTORS.ROOT).find(SELECTORS.COURSE_LIST).on('change', function() {\n            populateQuizSelector();\n        });\n        $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST).on('change', function() {\n            createBarChart();\n        });\n    };\n\n    var init = function(root) {\n        SELECTORS.ROOT = root;\n        $(document).ready(function() {\n            initEvents();\n            if ($(SELECTORS.ROOT).find(SELECTORS.CHART).length) {\n                createBarChart();\n            }\n        });\n    };\n    return {\n        init: init\n    };\n});\n"],"file":"quizstats.min.js"}