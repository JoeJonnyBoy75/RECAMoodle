{"version":3,"sources":["../src/courseanalytics.js"],"names":["define","$","Ajax","Chart","CustomEvents","RemuiblckEvents","SELECTORS","PAGECOUNT","PAGINATE","NEXT","PREVIOUS","CHARTPAGINATION","PAGES","TOGGLELABELS","PER_PAGE_FILTER","FILTER_OPTION","window","pageNumber","maxPage","analysisBar","getStartEnd","perPage","limit","start","end","labels","length","updateBars","root","totalBars","find","text","M","util","get_string","to","total","analysisChart","data","datasets","forEach","dataset","update","i","push","index","generatePagination","addClass","removeClass","Math","round","getAnalysisData","course_id","call","methodname","args","courseid","createAnalysisChart","done","response","destroy","error","html","maxactivityname","minactivityname","highest","lowest","average","context","get","getContext","backgroundColor","label","canvas","height","type","options","responsive","maintainAspectRatio","tooltips","enabled","hover","animationDuration","layout","padding","top","legend","position","fontSize","animation","duration","easing","onComplete","chartInstance","chart","ctx","font","helpers","fontString","defaults","global","defaultFontSize","defaultFontStyle","defaultFontFamily","textAlign","textBaseline","meta","controller","getDatasetMeta","hidden","bar","fillText","_model","x","y","scales","xAxes","display","gridLines","yAxes","ticks","beginAtZero","getCourseAnalyticsPerPage","fail","hide","registerCourseAnalyticsPerPageFilter","courseAnalyticsPerPageFilterContainer","events","activate","on","e","originalEvent","preventDefault","option","target","closest","hasClass","trigger","COURSE_ANALYTICS_PAGE_FILTER_CHANGE","set_user_preference","initEvents","is","init","document","ready"],"mappings":"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","sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-undef */\n/* eslint-disable no-loop-func */\n/* eslint-disable jsdoc/check-param-names */\n/* eslint-disable no-unused-vars */\n\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/chartjs',\n    'core/custom_interaction_events',\n    'block_remuiblck/events'\n], function ($, Ajax, Chart, CustomEvents, RemuiblckEvents) {\n\n    var SELECTORS = {\n        PAGECOUNT: '[data-action-page-count]',\n        PAGINATE: '[data-action-paginate]',\n        NEXT: '[data-next]',\n        PREVIOUS: '[data-previous]',\n        CHARTPAGINATION: '.analysis-chart-pagination',\n        PAGES: '[data-region-pages]',\n        TOGGLELABELS: '#togglelabels',\n        PER_PAGE_FILTER: '[data-region=\"per-page-filter\"]',\n        FILTER_OPTION: '[data-value]'\n    };\n    window['analysisChart'] = null;\n    var pageNumber = 1;\n    var maxPage = 1;\n    /* Course Analytics Block */\n    var analysisBar;\n\n    /**\n     * Get start and end index of bar data\n     *\n     * @param  {Number} perPage Total number of bars per page\n     * @return {Object}         Object with start and end value of bars\n     */\n    function getStartEnd(perPage) {\n        // default limit is 0\n        var limit = {\n            start: 0,\n            end: 0\n        };\n        if (analysisBar.labels == undefined) {\n            return limit;\n        }\n        // if number of bars is less or equal to per page then return limit with 1 and bars count\n        if (analysisBar.labels.length <= perPage) {\n            limit.start = 1;\n            limit.end = analysisBar.labels.length;\n            return limit;\n        }\n        limit.start = pageNumber == 1 ? 1 : (pageNumber - 1) * perPage + 1;\n        limit.end = pageNumber * perPage;\n        if (analysisBar.labels.length < limit.end) {\n            limit.end = analysisBar.labels.length;\n        }\n        return limit;\n    }\n\n    /**\n     * Update bars data in the chart based on start and end of bars\n     *\n     * @param {String} root      block root element id\n     * @param {Number} totalBars Total bar which can be shown in the chart\n     */\n    function updateBars(root, totalBars) {\n        // var {start, end} = getStartEnd(totalBars);\n        var limit = getStartEnd(totalBars);\n        // Update pagination label\n        $(root).find(SELECTORS.PAGES).text(M.util.get_string('showingfromto', 'block_remuiblck', {\n            start: limit.start,\n            to: limit.end,\n            total: analysisBar.labels.length\n        }));\n\n        // Remove previous bar data\n        analysisChart.data.labels = [];\n        analysisChart.data.datasets.forEach(function(dataset) {\n            dataset.data = [];\n        });\n        analysisChart.update();\n\n        // Add new bar data and re-render the chart\n        for (var i = limit.start - 1; i <= limit.end; i++) {\n            analysisChart.data.labels.push(analysisBar.labels[i]);\n            analysisChart.data.datasets.forEach(function(dataset, index) {\n                dataset.data.push(analysisBar.datasets[index].data[i]);\n            });\n            analysisChart.update();\n        }\n    }\n\n    /**\n     * Generate pagination data on page load\n     * @param {String} root    block root element id\n     * @param {Number} perPage bars to be shown per page\n     */\n    function generatePagination(root, perPage) {\n        // If there is no data then hide pagination and return\n        if (analysisBar.labels == undefined) {\n            $(root).find(SELECTORS.CHARTPAGINATION).addClass('d-none');\n            return;\n        }\n        pageNumber = 1;\n        // var {start, end} = getStartEnd(perPage);\n\n        // Show pagination\n        $(root).find(SELECTORS.CHARTPAGINATION).removeClass('d-none');\n        maxPage = analysisBar.labels.length > perPage ? Math.round(analysisBar.labels.length / perPage) : 1;\n        updateBars(root, perPage);\n    }\n\n    /**\n     * Get Analysis Data using ajax\n     *\n     * @param  {String} root block root element id\n     * @return {Ajax}   Ajax promise\n     */\n    function getAnalysisData(root) {\n        var course_id = $(root).find('#coursecategorylist option:selected').data('id');\n        return Ajax.call([{\n            methodname: 'block_remuiblck_get_course_analytics',\n            args: {\n                courseid: course_id\n            }\n        }])[0];\n    }\n\n    /**\n     * Create analysis chart from ajax data\n     *\n     * @param {String} root block root element id\n     */\n    function createAnalysisChart(root) {\n        getAnalysisData(root)\n        .done(function (response) {\n            analysisBar = response;\n            pageNumber = 1;\n            if (analysisChart !== null) {\n                analysisChart.destroy();\n            }\n\n            if (response.error) {\n                $(root).find(\"#highestactivity\").html(\"\");\n                $(root).find(\"#lowestactivity\").html(\"\");\n\n                $(root).find(\"#highestgrade\").html(\"0\");\n                $(root).find(\"#lowestgrade\").html(\"0\");\n                $(root).find(\"#averagegrade\").html(\"0\");\n            } else {\n                $(root).find(\"#highestactivity\").html(analysisBar.maxactivityname);\n                $(root).find(\"#lowestactivity\").html(analysisBar.minactivityname);\n\n                $(root).find(\"#highestgrade\").html(analysisBar.highest);\n                $(root).find(\"#lowestgrade\").html(analysisBar.lowest);\n                $(root).find(\"#averagegrade\").html(analysisBar.average);\n            }\n\n            var context = $(root).find(\"#analysischart\").get(0).getContext(\"2d\");\n            var datasets = [];\n            if (response.datasets != undefined) {\n                response.datasets.forEach(function(dataset) {\n                    datasets.push({\n                        data: [],\n                        backgroundColor: dataset.backgroundColor,\n                        label: dataset.label\n                    });\n                });\n            }\n            context.canvas.height = 400;\n            analysisChart = new Chart(context, {\n                data: {\n                    labels: [],\n                    datasets: datasets\n                },\n                type: 'bar',\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    tooltips: {\n                        enabled: true\n                    },\n                    hover: {\n                        animationDuration: 0\n                    },\n                    layout: {\n                        padding: {\n                            top: 20\n                        }\n                    },\n                    legend: {\n                        position: 'bottom',\n                        labels: {\n                            padding: 20,\n                            fontSize: 12\n                        }\n\n                    },\n                    animation: {\n                        duration: 300,\n                        easing: 'easeInOutQuad',\n                        onComplete: function () {\n                            var chartInstance = this.chart,\n                                ctx = chartInstance.ctx;\n                            ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);\n                            ctx.textAlign = 'center';\n                            ctx.textBaseline = 'bottom';\n\n                            this.data.datasets.forEach(function (dataset, i) {\n                                var meta = chartInstance.controller.getDatasetMeta(i);\n                                if (meta.hidden != true) {\n                                    meta.data.forEach(function (bar, index) {\n                                        var data = dataset.data[index];\n                                        ctx.fillText(data, bar._model.x, bar._model.y - 5);\n                                    });\n                                }\n                            });\n                        }\n                    },\n                    scales:\n                    {\n                        xAxes: [{\n                            display: false,\n                            gridLines: {\n                                display: true,\n                            }\n                        }],\n                        yAxes: [{\n                            ticks: {\n                                beginAtZero: true,\n                            },\n                            gridLines: {\n                                display: true\n                            },\n                        }]\n                    }\n                }\n            });\n            generatePagination(root, getCourseAnalyticsPerPage(root));\n        })\n        .fail(function (xhr, status, error) {\n            $(root).find('div#analysis-chart-area').hide();\n        });\n    }\n\n    /**\n     * Event listener for the per page selector\n     *\n     * @param {object} root The root element for the manage courses block\n     */\n    var registerCourseAnalyticsPerPageFilter = function(root) {\n        var courseAnalyticsPerPageFilterContainer = $(root).find(SELECTORS.PER_PAGE_FILTER);\n        CustomEvents.define(courseAnalyticsPerPageFilterContainer, [CustomEvents.events.activate]);\n        courseAnalyticsPerPageFilterContainer.on(\n            CustomEvents.events.activate,\n            SELECTORS.FILTER_OPTION,\n            function(e, data) {\n                data.originalEvent.preventDefault();\n\n                var option = $(e.target).closest(SELECTORS.FILTER_OPTION);\n\n                if (option.hasClass('active')) {\n                    // If it's already active then we don't need to do anything.\n                    return;\n                }\n\n                $(e.target).trigger(RemuiblckEvents.COURSE_ANALYTICS_PAGE_FILTER_CHANGE);\n                M.util.set_user_preference('courseanalyticsperpage', option.data('value'));\n                generatePagination(root, option.data('value'));\n            }\n        );\n    };\n\n    /**\n     * Get manage courses filter dropdown selection\n     *\n     * @param  {DOM}    root block root element id\n     * @return {string}      selected per page courses\n     */\n    var getCourseAnalyticsPerPage = function(root) {\n        return $(root).find(SELECTORS.PER_PAGE_FILTER).find(SELECTORS.FILTER_OPTION + '.active').data('value');\n    };\n\n    /**\n     * Initialize event listerns\n     *\n     * @param  {String} root block root element id\n     */\n    function initEvents(root) {\n        // Initialize per page filter events\n        registerCourseAnalyticsPerPageFilter(root);\n\n        // Traverse through page\n        $('body').on('click', root + ' ' + SELECTORS.PAGINATE, function() {\n            if ($(this).is(SELECTORS.NEXT)) {\n                if (pageNumber == maxPage) {\n                    return;\n                }\n                pageNumber++;\n            } else if($(this).is(SELECTORS.PREVIOUS)) {\n                if (pageNumber == 1) {\n                    return;\n                }\n                pageNumber--;\n            } else {\n                return;\n            }\n            var perPage = getCourseAnalyticsPerPage(root);\n            updateBars(root, perPage);\n        });\n\n        //Update chart on courses dropdown change\n        $('body').on('change', root + ' #coursecategorylist', function () {\n            createAnalysisChart(root);\n        });\n    }\n\n    /**\n     * Main method to be initialised for course analytics block\n     *\n     * @param  {String} root block root element id\n     */\n    var init = function(root) {\n        $(document).ready(function() {\n            initEvents(root);\n            if ($(root).find('#analysischart').length) {\n                createAnalysisChart(root);\n            }\n        });\n    };\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"courseanalytics.min.js"}