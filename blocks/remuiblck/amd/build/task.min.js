function _defineProperty(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}define ("block_remuiblck/task",["jquery","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/fragment","block_remuiblck/modal_task_popup","block_remuiblck/events","block_remuiblck/task_filters","block_remuiblck/task_view"],function(a,b,c,d,e,f,g,h,i,j,k){var l,m=(l={ADD_TASK:"[data-region=\"add-task\"]",TASK:"[data-region=\"task-item\"]",TASK_SUBJECT:"[data-toggle=\"collapse\"]",TASK_EDIT:"[data-action=\"edit\"]",TASK_POPUP:"[data-region='task-body']",TASK_DURATION_FILTER:"[data-region=\"task-duration-filter\"]",TASK_STATUS_FILTER:"[data-region=\"task-status-filter\"]",TASK_FILTER_OPTION:"[data-value]"},_defineProperty(l,"TASK_SUBJECT",".item-title .panel-heading span"),_defineProperty(l,"PANEL",".panel"),_defineProperty(l,"PANEL_HEADING",".panel-heading"),_defineProperty(l,"PANEL_ACTIONS","panel-actions"),_defineProperty(l,"TOASTER_CONTAINER","[aria-task-toasters]"),_defineProperty(l,"TOASTER_CONTAINER_ID","aria-task-toasters"),_defineProperty(l,"TASK_PROCESSING",".block-processing"),l),n={CREATE_NEW_TASK:function CREATE_NEW_TASK(a){return b.call([{methodname:"block_remuiblck_create_new_task",args:a}])[0]},EDIT_TASK:function EDIT_TASK(a){return b.call([{methodname:"block_remuiblck_edit_task",args:a}])[0]},COMPLETE_TASK:function COMPLETE_TASK(a,c){return b.call([{methodname:"block_remuiblck_complete_task",args:{id:a,status:c}}])[0]},DELETE_TASK:function DELETE_TASK(a){return b.call([{methodname:"block_remuiblck_delete_task",args:{id:a}}])[0]},NOTIFY_USERS:function NOTIFY_USERS(a,c){return b.call([{methodname:"block_remuiblck_task_notify_users",args:{id:a,type:c}}])[0]}},o={GET_TASK_FORM:function GET_TASK_FORM(a){return g.loadFragment("block_remuiblck","task_form",contextid,{taskid:a})}},p=function(a){a.hide();a.destroy()},q=function(b,c){var d=a(b).find(m.TASK+"[data-id=\""+c+"\"]");if(d){return d.find(m.TASK_SUBJECT).text()}return c},r=function(b,c,d,e){if(0==a(b).find("."+c+m.TOASTER_CONTAINER).length){a(b).append("<div class=\"toaster "+c+"\""+m.TOASTER_CONTAINER_ID+"role=\"alert\"></div>")}var f=a("<div class=\"toast toast-just-text "+d+" toast-shadow\"><div class=\"toast-message\">"+e+"</div></div>");a(b).find(m.TOASTER_CONTAINER).append(f);setTimeout(function(){f.addClass("show")},0);setTimeout(function(){f.removeClass("show");setTimeout(function(){f.remove()},250)},2e3)},s=function(b,d,g){var h=q(b,d);e.create({type:e.types.SAVE_CANCEL,title:M.util.get_string("deletetask","block_remuiblck"),body:M.util.get_string("deletetaskmessage","block_remuiblck",h)},a("#create")).done(function(a){a.setSaveButtonText(M.util.get_string("ok","moodle"));a.getRoot().on(f.save,function(){n.DELETE_TASK(d).done(function(d){if(!0==d.status){p(a);p(g);v(b);r(b,"toast-top-center","toast-error",M.util.get_string("taskdeleted","block_remuiblck",h));return}c.exception({name:d.msg})}).fail(c.exception)}).on(f.cancel,function(){p(a)});a.show()}).fail(c.exception)},t=function(a,b){var d=1<arguments.length&&arguments[2]!==void 0?arguments[2]:null;n.NOTIFY_USERS(a,b).done(d).fail(function(a){c.exception(a);if(null!=d){d()}})},u=function(b,d){e.create({type:h.TYPE,templateContext:{new:-1==d}},a("#create")).done(function(a){a.show();a.setBody(o.GET_TASK_FORM(d));a.getRoot().on(f.hidden,function(){p(a)}).on(i.TASK_SAVE,function(){if(!a.valid_settings()){return}a.saving();var e=a.get_task_settings();if(-1==d){n.CREATE_NEW_TASK(e).done(function(c){if(!0==e.notify){t(c,"create",function(){p(a);v(b)});return}p(a);v(b)}).fail(function(b){a.saving(!1);c.exception(b)});return}e.id=d;n.EDIT_TASK(e).done(function(){p(a);v(b)}).fail(function(b){a.saving(!1);c.exception(b)})}).on(i.TASK_DELETE,function(){s(b,d,a)}).on(i.TASK_CANCEL,function(){p(a)})})},v=function(a){k.loadTasks(a,j.getTaskDuration(a),j.getTaskStatus(a))},w=function(b,d,e){k.toggleTaskProcessing(b,!0);n.COMPLETE_TASK(d,e).done(function(f){if(!0==f.status){v(b);return}a(b+" "+m.TASK+"[data-id=\""+d+"\"]").find("input").prop("checked",!e);c.exception({name:f.msg});k.toggleTaskProcessing(b)}).fail(function(f){c.exception(f);a(b+" "+m.TASK+"[data-id=\""+d+"\"]").find("input").prop("checked",!e);k.toggleTaskProcessing(b)})},x=function(b){a("body").on("click",m.ADD_TASK,function(){u(b,-1)}).on("click",b+" "+m.TASK,function(c){if(a(c.target).is("input")){w(b,a(this).data("id"),a(c.target).is(":checked"));return}if(a(c.target).is(m.TASK_SUBJECT)){return}if(a(c.target).is(m.TASK_EDIT)||a(c.target).parent().is(m.TASK_EDIT)){u(b,a(this).data("id"))}})},y=function(b){var c=a(b).find(m.ADD_TASK).detach(),d=a(b).closest(m.PANEL).find(m.PANEL_HEADING),e=a(d).find("."+m.PANEL_ACTIONS);if(0==e.length){e=a("<div class=\""+m.PANEL_ACTIONS+"\"></div>");d.prepend(e)}e.prepend(c);c.removeClass("d-none");var f=a(b).find(m.TASK_PROCESSING).detach(),g=a(d).parent(m.PANEL);g.prepend(f)};return{init:function init(b){a(document).ready(function(){x(b);y(b)});k.init(b);j.init(b)}}});
//# sourceMappingURL=task.min.js.map
