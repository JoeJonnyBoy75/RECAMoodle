{"version":3,"sources":["../src/notes.js"],"names":["define","$","Ajax","SELECTORS","ADD_NOTE_BUTTON","ADD_NOTE_SELECT","SITE_NOTE","COURSE_NOTE","PERSONAL_NOTE","STUDENT_LIST","length","hide","courseId","studentCount","userId","courseName","on","children","attr","text","empty","call","methodname","args","courseid","done","response","Object","keys","show","append","M","util","get_string","each","index","student","id","fullname","fail","ex","html","message","find","val","notesLink","cfg","wwwroot"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax'], function($, Ajax) {\n     /* Add Notes Block */\n     var SELECTORS = {\n        ADD_NOTE_BUTTON: '.add-notes-button',\n        ADD_NOTE_SELECT: '.add-notes-select',\n        SITE_NOTE: '.site-note',\n        COURSE_NOTE: '.course-note',\n        PERSONAL_NOTE: '.personal-note',\n        STUDENT_LIST: '.select2-studentlist'\n     };\n    if ($(SELECTORS.ADD_NOTE_SELECT).length) {\n        $(SELECTORS.ADD_NOTE_BUTTON).hide();\n        $(SELECTORS.STUDENT_LIST).hide();\n        var courseId, studentCount, userId, courseName;\n\n        $(SELECTORS.ADD_NOTE_SELECT + ' select').on('change', function() {\n            $(SELECTORS.ADD_NOTE_BUTTON).hide();\n            courseId = $(this).children(\":selected\").attr(\"id\");\n            courseName = $(this).children(\":selected\").text();\n            if (courseId === undefined) {\n                $(SELECTORS.STUDENT_LIST).empty();\n                $(SELECTORS.STUDENT_LIST).hide();\n                return;\n            }\n            Ajax.call([{\n                methodname: 'block_remuiblck_get_enrolled_users_by_course',\n                args: {\n                    courseid: courseId\n                }\n            }])[0].done(function(response) {\n                studentCount = Object.keys(response).length;\n                $(SELECTORS.STUDENT_LIST).show();\n                $(SELECTORS.STUDENT_LIST).empty();\n                if (studentCount) {\n                    $(SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\n                        \"selectastudent\", \"block_remuiblck\") + ' (' + M.util.get_string(\"total\", \"moodle\") +\n                        ': ' + studentCount + ')</option>');\n\n                    $.each(response, function(index, student) {\n                        $(SELECTORS.STUDENT_LIST).append('<option value=\"' + student.id + '\">' + student.fullname + '</option>');\n                    });\n\n                } else {\n                    $(SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\"nousersenrolledincourse\",\n                        \"block_remuiblck\", courseName) + '</option>');\n                }\n\n            }).fail(function(ex) {\n                $(SELECTORS.STUDENT_LIST).html('<option>' + ex.message + '</option>');\n            });\n        });\n\n        $(SELECTORS.STUDENT_LIST).on('change', function() {\n            $(SELECTORS.ADD_NOTE_BUTTON).show();\n            userId = $(this).find('option:selected').val();\n            var notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                '&userid=' + userId + '&publishstate=site';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.SITE_NOTE).attr('href', notesLink);\n            notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                '&userid=' + userId + '&publishstate=public';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.COURSE_NOTE).attr('href', notesLink);\n            notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                '&userid=' + userId + '&publishstate=draft';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.PERSONAL_NOTE).attr('href', notesLink);\n        });\n    }\n    /* End - Add Notes Block */\n});\n"],"file":"notes.min.js"}