{"version":3,"sources":["../src/manage_courses.js"],"names":["define","$","ajax","Notification","ModalFactory","ModalSaveCancel","ModalEvents","ManageCoursesView","ManageCoursesFilters","SELECTORS","VIEW_REPORT","STATS_TAB","STATS_TABLE","EXPORT_WRAPPER","EXPORT","STATS_CHART","STATS_FILTER_INPUT","DROPPING_STUDENT_MESSAGE","PROMISES","GET_COURSE_REPORT","courseid","call","methodname","args","GET_DROPPING_OFF_STUDENTS","search","length","start","order","EXPORT_DROPPING_OFF_STUDENTS","SEND_MESSAGE","studentid","messagetext","on","event","preventDefault","_this","trigger","create","title","attr","done","modal","addClass","getRoot","hidden","destroy","setBody","data","response","find","ctx","getContext","Chart","type","labels","M","util","get_string","datasets","backgroundColor","studentcompletedcolor","inprogresscolor","yettostartcolor","options","legend","display","fail","exception","setTimeout","show","is","DataTable","append","callback","value","row","index","val","file","encodeURIComponent","filedata","filename","hide","click","remove","types","SAVE_CANCEL","setSaveButtonText","parent","siblings","html","save","message","ex","init","root","document","ready"],"mappings":"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","sourcesContent":["/* eslint-disable no-unused-vars */\n/* eslint-disable max-len */\n/* eslint-disable no-undef */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/modal_factory',\n    'core/modal_save_cancel',\n    'core/modal_events',\n    'block_remuiblck/manage_courses_view',\n    'block_remuiblck/manage_courses_filters',\n    'core/chartjs',\n    'block_remuiblck/jquery.dataTables',\n    'block_remuiblck/dataTables.bootstrap4'\n], function(\n    $,\n    ajax,\n    Notification,\n    ModalFactory,\n    ModalSaveCancel,\n    ModalEvents,\n    ManageCoursesView,\n    ManageCoursesFilters\n) {\n\n    var SELECTORS = {\n        VIEW_REPORT: '.remui-view-course-report',\n        STATS_TAB: '#wdm-userstats',\n        STATS_TABLE: '#userstats-table',\n        EXPORT_WRAPPER: '#userstats-table_wrapper .wdm-export-buttons',\n        EXPORT: '.wdm-manage-course-export-csv',\n        STATS_CHART: '#coursestats-chart',\n        STATS_FILTER_INPUT: '#userstats-table_filter input',\n        DROPPING_STUDENT_MESSAGE: '.dropping-student-message'\n    };\n\n    var PROMISES = {\n        /**\n         * Get course report promise\n         * @param  {int} courseid Course id\n         * @return {promise}           Ajax promise object\n         */\n        GET_COURSE_REPORT: function(courseid) {\n            return ajax.call([{\n                methodname: 'block_remuiblck_get_course_report',\n                args: {\n                    courseid: courseid\n                }\n            }])[0];\n        },\n\n        /**\n         * Get dropping off students list promise\n         * @param {int}     courseid Course id\n         * @param {String}  search   Search query\n         * @param {int}     length   Number of rows per page\n         * @param {int}     start    Starting row number\n         * @param {object}  order    Sorting order\n         * @return {promise}           Ajax promise object\n         */\n        GET_DROPPING_OFF_STUDENTS: function(courseid, search, length, start, order) {\n            return ajax.call([{\n                methodname: 'block_remuiblck_get_dropping_off_students',\n                args: {\n                    courseid: courseid,\n                    search: search,\n                    length: length,\n                    start: start,\n                    order: order\n                }\n            }])[0];\n        },\n\n        /**\n         * Export dropping off students list promise\n         * @param {int}     courseid Course id\n         * @param {string}  search   search query\n         * @return {promise}           Ajax promise object\n         */\n        EXPORT_DROPPING_OFF_STUDENTS: function(courseid, search) {\n            return ajax.call([{\n                methodname: 'block_remuiblck_export_dropping_off_students',\n                args: {\n                    courseid: courseid,\n                    search: search\n                }\n            }])[0];\n        },\n        /**\n         * Send message to student using student id and ajax\n         * @param  {Number} studentid   Student id\n         * @param  {String} messagetext Message text\n         * @return {Promise}            Ajax promise\n         */\n        SEND_MESSAGE: function(studentid, messagetext) {\n            return ajax.call([{\n                methodname: 'block_remuiblck_send_message',\n                args: {\n                    studentid: studentid,\n                    messagetext: messagetext\n                }\n            }])[0];\n        }\n    };\n    $('body').on('click', SELECTORS.VIEW_REPORT, function() {\n        event.preventDefault();\n        var _this = this;\n        var trigger = $('#create-modal');\n        ModalFactory.create({\n            title: $(_this).attr('title')\n        }, trigger).done(function(modal) {\n            modal.modal.addClass('modal-lg');\n\n            // Destroy when hidden.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            }).addClass('fade');\n\n            // Show loading icon till load modal body\n            modal.setBody('<i class=\"fa fa-circle-o-notch fa-spin fa-fw\" aria-hidden=\"true\"></i>');\n\n            // Fetch body using ajax request\n            PROMISES.GET_COURSE_REPORT($(_this).data('course-id'))\n            .done(function(response) {\n                modal.setBody(response);\n                if (modal.getRoot().find(SELECTORS.STATS_CHART).length != 0) {\n                    var ctx = modal.getRoot().find(SELECTORS.STATS_CHART)[0].getContext('2d');\n                    new Chart(ctx, {\n                        type: 'doughnut',\n                        data: {\n                            labels: [\n                                M.util.get_string('studentcompleted', 'block_remuiblck'),\n                                M.util.get_string('inprogress', 'block_remuiblck'),\n                                M.util.get_string('yettostart', 'block_remuiblck')\n                            ],\n                            datasets: [{\n                                backgroundColor: [\n                                    studentcompletedcolor,\n                                    inprogresscolor,\n                                    yettostartcolor\n                                ],\n                                data: [\n                                    modal.getRoot().find(SELECTORS.STATS_CHART).data('studentcompleted'),\n                                    modal.getRoot().find(SELECTORS.STATS_CHART).data('inprogress'),\n                                    modal.getRoot().find(SELECTORS.STATS_CHART).data('yettostart')\n                                ]\n                            }]\n                        },\n                        options: {\n                            legend: {\n                                display: false\n                            }\n                        }\n                    });\n                }\n            })\n            .fail(Notification.exception);\n\n            // Show modal\n            setTimeout(modal.show(), 100);\n        });\n        return;\n    }).on('click', SELECTORS.STATS_TAB, function() {\n        if ($(SELECTORS.STATS_TABLE).is('.dataTable')) {\n            return;\n        }\n        $(SELECTORS.STATS_TABLE).DataTable({\n            \"bPaginate\": true,\n            \"bServerSide\": true,\n            \"language\": {\n                \"searchPlaceholder\": M.util.get_string('searchnameemail', 'block_remuiblck'),\n                \"emptyTable\": M.util.get_string('nostudentsenrolled', 'block_remuiblck')\n            },\n            \"dom\": '<\"wdm-export-buttons\">frtip',\n            \"initComplete\": function(settings, json) {\n                $(SELECTORS.EXPORT_WRAPPER).append(\n                    \"<button class='wdm-manage-course-export-csv btn btn-primary' data-course-id='\" + $(this).data('course-id') + \"'>\" + M.util.get_string(\n                        'exportcsv',\n                        'block_remuiblck'\n                    ) + \"</button>\"\n                );\n            },\n            \"ajax\": function(data, callback, settings) {\n                PROMISES.GET_DROPPING_OFF_STUDENTS(\n                    $(this).data('course-id'),\n                    data.search.value,\n                    data.length,\n                    data.start,\n                    data.order[0]\n                ).done(function(response) {\n                    callback(response);\n                }).fail(Notification.exception);\n            },\n            \"columns\": [\n                {\"className\": \"pb-0 pt-0\", \"data\": \"name\"},\n                {\"className\": \"pb-0 pt-0\", \"data\": \"email\"},\n                {\"className\": \"pb-0 pt-0\", \"data\": \"enroltimestart\"},\n                {\"className\": \"pb-0 pt-0\", \"data\": \"lastaccess\"}\n            ],\n            \"rowCallback\": function(row, data, index) {\n                if (index % 2 == 0) {\n                    $(row).addClass('bg-grey-100');\n                } else {\n                    $(row).addClass('bg-grey-200');\n                }\n            }\n        });\n    }).on('click', SELECTORS.EXPORT, function() {\n        var _this = this;\n        PROMISES.EXPORT_DROPPING_OFF_STUDENTS(\n            $(_this).data('course-id'),\n            $(SELECTORS.STATS_FILTER_INPUT).val()\n        ).done(function(response) {\n            var file = $('<a></a>');\n            $('body').append(file);\n            $(file).attr('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(response.filedata));\n            $(file).attr('download', response.filename).hide()[0].click();\n            $(file).remove();\n        }).fail(Notification.exception);\n    }).on('click', SELECTORS.DROPPING_STUDENT_MESSAGE, function() {\n        var _this = this;\n        var trigger = $('#create-modal');\n        ModalFactory.create({\n            type: ModalFactory.types.SAVE_CANCEL,\n            title: M.util.get_string('sendmessage', 'core_message')\n        }, trigger).done(function(modal) {\n\n            // Set button text as send\n            modal.setSaveButtonText(M.util.get_string('send', 'core_message'));\n\n            // Add textarea field in body\n\n            modal.setBody('<label>' + M.util.get_string('sendmessageto', 'core_message', $($(_this).parent('td').siblings()[0]).html()) + '</label><textarea class=\"form-control message\" rows=\"5\" autocomplete=\"off\"></textarea>');\n\n            // Destroy when hidden.\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n\n            // Send message when save button is clicked\n            modal.getRoot().on(ModalEvents.save, function(event) {\n                var studentid = $(_this).data('student-id');\n                var message = $(this).find('.message').val();\n                if (message != '') {\n                    PROMISES.SEND_MESSAGE(studentid, message)\n                    .done(function(response) {\n                        modal.destroy();\n                    })\n                    .fail(function(ex) {\n                        Notification.exception(ex);\n                    });\n                }\n            }).addClass('modal-success fade');\n            modal.modal.addClass('modal-center');\n\n            // Show modal\n            setTimeout(modal.show(), 100);\n        });\n    });\n\n    var init = function(root) {\n        $(document).ready(function() {\n            ManageCoursesView.init(root);\n            ManageCoursesFilters.init(root);\n        });\n    };\n    return {\n        init: init\n    };\n});\n"],"file":"manage_courses.min.js"}