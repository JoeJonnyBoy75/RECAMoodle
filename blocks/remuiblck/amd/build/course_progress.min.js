function _defineProperty(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}define ("block_remuiblck/course_progress",["jquery","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/modal_save_cancel","block_remuiblck/dataTables.bootstrap4","block_remuiblck/jquery-asPieProgress","block_remuiblck/aspieprogress"],function(a,b,c,d,e,f){var g,h=(g={ROOT:"",TABLE:"#DataTables_Teacher",DATA_TABLE:"#DataTables_Teacher_wrapper",STUDENT_PROGRESS_ELEMENT:".student_progress_ele",STUDENT_PROGRESS_TABLE:"#wdmCourseProgressTable",COURSE_NAME:".wdm_course_name.has-student",MESSAGE_HIDDEN:"#messageidhidden",MESSAGE_AREA:"#messagearea",TOGGLE_DESCRIPTION:".toggle-desc",REVERT:"#courserevertbtn",CUSTOM_MESSAGE:".custom-message",MESSAGE_SEND:".send-message",BLOCK_PROCESSING:".block-processing",ALWAYS_LOAD:"#always-load-progress",COURSE_PROGRESSING:".course-progress-settings",LOAD_COURSE_PROGRESS:"#load-progress",PANEL:".panel",PANEL_HEADING:".panel-heading",PANEL_ACTIONS:"panel-actions"},_defineProperty(g,"BLOCK_PROCESSING",".block-processing"),_defineProperty(g,"STUDENT_PROOGRESS_VISIBLE","student-progress-visible"),g),i={coursesTable:!1,alwaysloadwarning:!1},j={GET_COURSES:function GET_COURSES(a,c,d,e,f){return b.call([{methodname:"block_remuiblck_get_course_progress_list",args:{search:a,length:c,start:d,order:e,loadprogress:f}}])[0]},GET_COURSE_PROGRESS:function GET_COURSE_PROGRESS(a){return b.call([{methodname:"block_remuiblck_get_course_progress",args:{courseid:a}}])[0]},SEND_MESSAGE:function SEND_MESSAGE(a,c){return b.call([{methodname:"block_remuiblck_send_message",args:{studentid:a,messagetext:c}}])[0]}};function k(a){var b=[];a.forEach(function(a){var c={index:"<div class=\"w-50\" tabindex=\"0\">"+a.index+"</div>"};if(0<a.enrolledStudents){c.course="<div class=\"wdm_course_name has-student\" data-courseid=\""+a.id+"\"><a href=\"javascript:void(0)\">"+a.fullname+"</a></div>"}else{c.course="<div class=\"wdm_course_name\" data-courseid=\""+a.id+"\" >"+a.fullname+"</div>"}c.startdate=a.startdate;c.students="<div class=\"w-100\"><span class=\"w-full pl-40\">"+a.enrolledStudents+"</span></div>";if(-1==a.percentage){c.progress=""}else{c.progress="<td class=\"w-100 px-10\"><div class=\"pie-progress pie-progress-xs m-0 w-35\" data-plugin=\"pieProgress\" data-valuemax=\"50\" data-barcolor=\"#11c26d\" data-size=\"20\" data-barsize=\"3\" data-goal=\"35\" aria-valuenow=\""+a.percentage+"\" role=\"progressbar\" style=\"max-width: 35px!important;\"><div class=\"pie-progress-content\" style=\"z-index:2;\"> </div> <span class=\" progress-percent\" style=\"margin-left: 50px;position: absolute;top: 8px;\">"+a.percentage+"%</span> </div></td>"}b.push(c)});return b}function l(b){i.coursesTable=a(b).show().find(h.TABLE).DataTable({paging:!0,pagingType:"simple_numbers",autoWidth:!0,scrollX:!0,bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("search","moodle"),emptyTable:M.util.get_string("nomatchingcourses","core_backup"),lengthMenu:M.util.get_string("show","moodle")+" _MENU_ "+M.util.get_string("entries","moodle"),paginate:{first:M.util.get_string("first","moodle"),previous:M.util.get_string("previous","moodle"),next:M.util.get_string("next","moodle"),last:M.util.get_string("last","moodle")}},ajax:function ajax(d,e){a(b).find(h.BLOCK_PROCESSING).addClass("show");var f=a(b+" "+h.COURSE_PROGRESSING).is(".load-progress");j.GET_COURSES(d.search.value,d.length,d.start,d.order[0],f).done(function(c){if(0==c.recordsTotal){c.data=[];e(c);a(b).find(h.BLOCK_PROCESSING).removeClass("show");return}c.data=k(c.courses);e(c);a(b).find(h.BLOCK_PROCESSING).removeClass("show")}).fail(c.exception)},columns:[{data:"index"},{data:"course"},{data:"startdate"},{data:"students",orderable:!1},{data:"progress",orderable:!1}],responsive:!0,drawCallback:function drawCallback(){m("")}})}function m(b){var c=a(h.ROOT);if(""!=b){c=c.find(b)}c.find(".pie-progress").asPieProgress({namespace:"pie-progress",speed:30,classes:{svg:"pie-progress-svg",element:"pie-progress",number:"pie-progress-number",content:"pie-progress-content"}})}var n;function o(b){a(h.ROOT).find(h.BLOCK_PROCESSING).addClass("show");j.GET_COURSE_PROGRESS(b).done(function(b){d.render("block_remuiblck/course_progress_view",b).done(function(b,c){a(h.ROOT).find(h.DATA_TABLE).hide();d.replaceNodeContents(a(h.ROOT).find(h.STUDENT_PROGRESS_ELEMENT),b,c);m(h.STUDENT_PROGRESS_ELEMENT);n=a(h.ROOT).find(h.STUDENT_PROGRESS_TABLE).DataTable({scrollY:"300px",scrollCollapse:!0,paging:!1,retrieve:!0,lengthchange:!1,autoWidth:!0,scrollX:!0,search:"Fred",info:!1,language:{searchPlaceholder:"Search"},responsive:!0});a(h.ROOT).find("div.dataTables_filter input").addClass("form-control");a(h.ROOT).find("div.dataTables_length select").addClass("form-control");a(h.ROOT).addClass(h.STUDENT_PROOGRESS_VISIBLE);a(h.ROOT).find(h.BLOCK_PROCESSING).removeClass("show");a("html, body").animate({scrollTop:a(h.ROOT).offset().top-120},300)}).fail(function(){})}).fail(function(){a(h.ROOT).find("div#analysis-chart-area").hide()})}function p(b,d){j.SEND_MESSAGE(b,d).done(function(){q();a(h.ROOT).find(".close-message").click()}).fail(function(b){c.exception(b);a(h.ROOT).find("div#analysis-chart-area").hide()})}function q(){a(h.ROOT).find(h.MESSAGE_HIDDEN).val("");a(h.ROOT).find(h.MESSAGE_AREA).val("")}function r(b){M.util.set_user_preference("always-load-progress",b);a(h.ROOT).find(h.COURSE_PROGRESSING).toggleClass("always-loading",b);a(h.ROOT).find(h.COURSE_PROGRESSING).toggleClass("load-progress",b);i.coursesTable.draw(!1)}function s(b){a("body").on("click",b+" "+h.COURSE_NAME,function(){var b=a(this).data("courseid");o(b)}).on("click",b+" "+h.REVERT,function(){n.destroy();a(b).find(h.STUDENT_PROGRESS_ELEMENT).empty();a(b).find(h.DATA_TABLE).show();a(b).removeClass(h.STUDENT_PROOGRESS_VISIBLE);a("html, body").animate({scrollTop:a(h.ROOT).offset().top-120},300)}).on("click",b+" "+h.CUSTOM_MESSAGE,function(){var b=a(this).data("studentid");a(h.MESSAGE_HIDDEN).val(b)}).on("click",b+" "+h.MESSAGE_SEND,function(){var c=a(b).find(h.MESSAGE_HIDDEN).val(),d=a(b).find(h.MESSAGE_AREA).val();if(""!=d){p(c,d)}else{a(h.MESSAGE_AREA).focus()}}).on("click",h.STUDENT_PROGRESS_ELEMENT+" "+h.TOGGLE_DESCRIPTION,function(){a(this).toggleClass("fa-plus");a(this).toggleClass("fa-minus");a(this).parents(h.STUDENT_PROGRESS_ELEMENT).find(".panel-body").toggleClass("show")}).on("change",b+" "+h.ALWAYS_LOAD,function(){var b=a(this),c=a(this).is(":checked");if(!i.alwaysloadwarning&&c){e.create({type:e.types.SAVE_CANCEL,title:M.util.get_string("alwaysload","block_remuiblck"),body:M.util.get_string("alwaysloadwarning","block_remuiblck")}).then(function(a){var d=a.getRoot();d.on(f.save,function(){i.alwaysloadwarning=!0;M.util.set_user_preference("always-load-warning",!0);r(c);a.destroy()});d.on(f.cancel,function(){b.prop("checked",!1)});a.show()})}else{r(c)}}).on("click",b+" "+h.LOAD_COURSE_PROGRESS,function(){a(b).find(h.COURSE_PROGRESSING).addClass("load-progress");i.coursesTable.draw(!1)});a(b+" "+h.TABLE).on("order.dt",function(){m("")});a(b+" "+h.STUDENT_PROGRESS_TABLE).on("order.dt",function(){m("")})}var t=function(b){var c=a(b).find(h.COURSE_PROGRESSING).detach(),d=a(b).closest(h.PANEL).find(h.PANEL_HEADING),e=a(d).find("."+h.PANEL_ACTIONS);if(0==e.length){e=a("<div class=\""+h.PANEL_ACTIONS+"\"></div>");d.prepend(e)}e.prepend(c);c.removeClass("d-none");var f=a(b).find(h.BLOCK_PROCESSING).detach(),g=a(d).parent(h.PANEL);g.prepend(f)};return{init:function init(b){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1;h.ROOT=b;i.alwaysloadwarning=c;a(document).ready(function(){t(b);m("");l(b);s(b)})}}});
//# sourceMappingURL=course_progress.min.js.map
