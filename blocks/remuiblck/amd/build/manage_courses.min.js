define ("block_remuiblck/manage_courses",["jquery","core/ajax","core/notification","core/modal_factory","core/modal_save_cancel","core/modal_events","block_remuiblck/manage_courses_view","block_remuiblck/manage_courses_filters","core/chartjs","block_remuiblck/jquery.dataTables","block_remuiblck/dataTables.bootstrap4"],function(a,b,c,d,e,f,g,h){var i={VIEW_REPORT:".remui-view-course-report",STATS_TAB:"#wdm-userstats",STATS_TABLE:"#userstats-table",EXPORT_WRAPPER:"#userstats-table_wrapper .wdm-export-buttons",EXPORT:".wdm-manage-course-export-csv",STATS_CHART:"#coursestats-chart",STATS_FILTER_INPUT:"#userstats-table_filter input",DROPPING_STUDENT_MESSAGE:".dropping-student-message"},j={GET_COURSE_REPORT:function GET_COURSE_REPORT(a){return b.call([{methodname:"block_remuiblck_get_course_report",args:{courseid:a}}])[0]},GET_DROPPING_OFF_STUDENTS:function GET_DROPPING_OFF_STUDENTS(a,c,d,e,f){return b.call([{methodname:"block_remuiblck_get_dropping_off_students",args:{courseid:a,search:c,length:d,start:e,order:f}}])[0]},EXPORT_DROPPING_OFF_STUDENTS:function EXPORT_DROPPING_OFF_STUDENTS(a,c){return b.call([{methodname:"block_remuiblck_export_dropping_off_students",args:{courseid:a,search:c}}])[0]},SEND_MESSAGE:function SEND_MESSAGE(a,c){return b.call([{methodname:"block_remuiblck_send_message",args:{studentid:a,messagetext:c}}])[0]}};a("body").on("click",i.VIEW_REPORT,function(){event.preventDefault();var b=this,e=a("#create-modal");d.create({title:a(b).attr("title")},e).done(function(d){d.modal.addClass("modal-lg");d.getRoot().on(f.hidden,function(){d.destroy()}).addClass("fade");d.setBody("<i class=\"fa fa-circle-o-notch fa-spin fa-fw\" aria-hidden=\"true\"></i>");j.GET_COURSE_REPORT(a(b).data("course-id")).done(function(a){d.setBody(a);if(0!=d.getRoot().find(i.STATS_CHART).length){var b=d.getRoot().find(i.STATS_CHART)[0].getContext("2d");new Chart(b,{type:"doughnut",data:{labels:[M.util.get_string("studentcompleted","block_remuiblck"),M.util.get_string("inprogress","block_remuiblck"),M.util.get_string("yettostart","block_remuiblck")],datasets:[{backgroundColor:[studentcompletedcolor,inprogresscolor,yettostartcolor],data:[d.getRoot().find(i.STATS_CHART).data("studentcompleted"),d.getRoot().find(i.STATS_CHART).data("inprogress"),d.getRoot().find(i.STATS_CHART).data("yettostart")]}]},options:{legend:{display:!1}}})}}).fail(c.exception);setTimeout(d.show(),100)})}).on("click",i.STATS_TAB,function(){if(a(i.STATS_TABLE).is(".dataTable")){return}a(i.STATS_TABLE).DataTable({bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("searchnameemail","block_remuiblck"),emptyTable:M.util.get_string("nostudentsenrolled","block_remuiblck")},dom:"<\"wdm-export-buttons\">frtip",initComplete:function initComplete(){a(i.EXPORT_WRAPPER).append("<button class='wdm-manage-course-export-csv btn btn-primary' data-course-id='"+a(this).data("course-id")+"'>"+M.util.get_string("exportcsv","block_remuiblck")+"</button>")},ajax:function(b,d){j.GET_DROPPING_OFF_STUDENTS(a(this).data("course-id"),b.search.value,b.length,b.start,b.order[0]).done(function(a){d(a)}).fail(c.exception)},columns:[{className:"pb-0 pt-0",data:"name"},{className:"pb-0 pt-0",data:"email"},{className:"pb-0 pt-0",data:"enroltimestart"},{className:"pb-0 pt-0",data:"lastaccess"}],rowCallback:function rowCallback(b,c,d){if(0==d%2){a(b).addClass("bg-grey-100")}else{a(b).addClass("bg-grey-200")}}})}).on("click",i.EXPORT,function(){var b=this;j.EXPORT_DROPPING_OFF_STUDENTS(a(b).data("course-id"),a(i.STATS_FILTER_INPUT).val()).done(function(b){var c=a("<a></a>");a("body").append(c);a(c).attr("href","data:text/plain;charset=utf-8,"+encodeURIComponent(b.filedata));a(c).attr("download",b.filename).hide()[0].click();a(c).remove()}).fail(c.exception)}).on("click",i.DROPPING_STUDENT_MESSAGE,function(){var b=this,e=a("#create-modal");d.create({type:d.types.SAVE_CANCEL,title:M.util.get_string("sendmessage","core_message")},e).done(function(d){d.setSaveButtonText(M.util.get_string("send","core_message"));d.setBody("<label>"+M.util.get_string("sendmessageto","core_message",a(a(b).parent("td").siblings()[0]).html())+"</label><textarea class=\"form-control message\" rows=\"5\" autocomplete=\"off\"></textarea>");d.getRoot().on(f.hidden,function(){d.destroy()});d.getRoot().on(f.save,function(){var e=a(b).data("student-id"),f=a(this).find(".message").val();if(""!=f){j.SEND_MESSAGE(e,f).done(function(){d.destroy()}).fail(function(a){c.exception(a)})}}).addClass("modal-success fade");d.modal.addClass("modal-center");setTimeout(d.show(),100)})});return{init:function init(b){a(document).ready(function(){g.init(b);h.init(b)})}}});
//# sourceMappingURL=manage_courses.min.js.map
