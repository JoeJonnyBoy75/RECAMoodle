define("block_edwiserratingreview/reviewapprover",["jquery","core/ajax","core/modal_factory","core/modal_events","block_edwiserratingreview/jquery.dataTables","block_edwiserratingreview/dataTables.bootstrap4"],(function($,Ajax,ModalFactory,ModalEvents){const SELECTOR_minDate="#min",SELECTOR_maxDate="#max",SELECTOR_pendingapproval="#pendingforapproval",getSelectedDateRange=()=>[$(SELECTOR_minDate).val(),$(SELECTOR_maxDate).val()];return{init:()=>{$(document).ready((function(){var bodycontent="",titlecontent="",reveiwid="",table=$("#example").DataTable({searching:!1,autoWidth:!0,serverSide:!0,bLengthChange:!1,responsive:!0,columns:[{data:"reviewfor",orderable:!0,className:"ellip ellip-5 e-h-100"},{data:"name",orderable:!1},{data:"email",orderable:!1},{data:"ratings",orderable:!1,className:"e-w-75"},{data:"review",orderable:!1,className:"ellip ellip-5 e-h-100"},{data:"date"},{data:"action",orderable:!1}],ajax:function(data,callback,settings){const[min,max]=getSelectedDateRange();Ajax.call([{methodname:"block_edwiserratingreview_get_reviews",args:{start:data.start,length:data.length,order:5==data.order[0].column?data.order[0].dir:"desc",mindate:min,maxdate:max,loadonlypending:$(SELECTOR_pendingapproval).is(":checked")},done:function(response){callback(response)},fail:function(response){console.log("failed to load")}}])}});$(SELECTOR_minDate).keypress((function(event){event.preventDefault()})),$(SELECTOR_maxDate).keypress((function(event){event.preventDefault()})),$(SELECTOR_minDate).change((function(){const[min,max]=getSelectedDateRange();min>max&&""!=max&&$(SELECTOR_maxDate).val(min),$(SELECTOR_maxDate).attr("min",min),table.draw()})),$(SELECTOR_maxDate).change((function(){table.draw()})),$(SELECTOR_pendingapproval).on("change",(function(){table.draw()}));var updateapprove=function(reviewid,approvevalue,approveflag){Ajax.call([{methodname:"block_edwiserratingreview_updateapprove",args:{reviewid:reviewid,approvevalue:approvevalue,approveflag:approveflag},done:function(response){console.log(response)},fail:function(response){console.log("failed to load")}}])},approvalmodal=function(bodycontent,titlecontent,approvevalue,approvaflag,buttontext){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:titlecontent,body:bodycontent}).then((function(modal){modal,modal.setSaveButtonText(buttontext),modal.getRoot().on(ModalEvents.save,(function(){updateapprove(reveiwid,approvevalue,approvaflag),table.draw("page")})),modal.show()}))},bodydata=function(currentbtn){var currentrow=$(currentbtn).closest("tr"),col0=currentrow.find("td:eq(0)").text(),col1=currentrow.find("td:eq(1)").text(),col2=currentrow.find("td:eq(2)").text(),col3=currentrow.find("td:eq(3)").html(),col4=currentrow.find("td:eq(4)").text(),col5=currentrow.find("td:eq(5)").text();return"<p>".concat(col0,"</p><p>").concat(col1,"</p><p>").concat(col2,"</p><p>").concat(col3,"</p><p>").concat(col4,"</p><p>").concat(col5,"</p>")};$(document).on("click",".reviewapprovebtn",(function(){bodycontent=bodydata(this),titlecontent="Approve Review",reveiwid=$(this).attr("data-id"),approvalmodal(bodycontent,titlecontent,1,!0,"Approve")})),$(document).on("click",".denyapprovemodal",(function(){bodycontent=bodydata(this),titlecontent="Unpublish Review",reveiwid=$(this).attr("data-id"),approvalmodal(bodycontent,titlecontent,0,!0,"Move to draft")})),$(document).on("click",".instantapprove",(function(){updateapprove($(this).attr("data-id"),1,!0),table.draw("page")})),$(document).on("click",".deniedapproval",(function(){updateapprove($(this).attr("data-id"),0,!0),table.draw("page")})),$(document).on("click",".reviewremovebtn",(function(){bodycontent="<p>Are you sure you want to delete the selected review?</p>",titlecontent="Delete Review",reveiwid=$(this).attr("data-id"),approvalmodal(bodycontent,titlecontent,0,!1,"Confirm")}))}))}}}));

//# sourceMappingURL=reviewapprover.min.js.map