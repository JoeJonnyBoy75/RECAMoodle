{"version":3,"file":"showmorepagereview.min.js","sources":["../src/showmorepagereview.js"],"sourcesContent":["/* eslint-disable no-alert */\n/* eslint-disable no-console */\ndefine(['jquery',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'block_edwiserratingreview/reviewfilter'\n],\n    function (\n        $,\n        Ajax,\n        Notification,\n    ) {\n        var isModified = false;\n        var rating = 0;\n        var coursecontext = '';\n\n        var SELECTORS = {\n            MAINPAGEREVIEW: '.mainpagereview',\n            SHOWMOREPAGECOURSEBTN: '.showmorepagecoursebtn',\n            SHOWMOREPAGECOURSEMENU: '.ernr_showmorepagecoursemenu',\n            SERACHCOURSEINPUT: 'ernr_searchcourse',\n        };\n\n        var init = function (value, start, limit, contextid) {\n            coursecontext = contextid;\n            Ajax.call([{\n                methodname: 'block_edwiserratingreview_show_review',\n                args: { rating: value, startlimit: start, lastlimit: limit, contextid: coursecontext },\n                done: function (data) {\n                    if (isModified == true) {\n                        replaceData(data);\n                    } else {\n                        appendData(data);\n                    }\n                    rating = value;\n                },\n                fail: function () {\n                    console.log(Notification.exception);\n                }\n\n            }]);\n\n        };\n\n        var getCourselist = function (coursecontext) {\n            console.log(\"get courselist\");\n            Ajax.call([{\n                methodname: 'block_edwiserratingreview_getcourselist',\n                args: { coursecontext: coursecontext },\n                done: function (data) {\n                    $(SELECTORS.SHOWMOREPAGECOURSEMENU).empty().append(data);\n                },\n                fail: function () {\n                    console.log(Notification.exception);\n                }\n\n            }]);\n        };\n\n        var appendData = function (data) {\n            $(SELECTORS.MAINPAGEREVIEW).append(data);\n        };\n\n        var replaceData = function (data) {\n            if (data == '') {\n                $(SELECTORS.MAINPAGEREVIEW).empty().append(\"No Review Found\");\n            } else {\n                $(SELECTORS.MAINPAGEREVIEW).empty().append(data);\n            }\n\n        };\n\n        return {\n            init: function (value, start, limit, coursecontext) {\n                $(document).ready(function () {\n                    init(value, start, limit, coursecontext);\n                    getCourselist(coursecontext);\n                    $(\".showmorepagereviewselector option[value='\" + value + \"']\").attr(\"selected\", \"selected\");\n                    $(\".ernr_showmorepagecoursemenu option[value='\" + coursecontext + \"']\").attr(\"selected\", \"selected\");\n\n\n                });\n\n                $(window).on(\"scroll\", function () {\n                    var scrollHeight = $(document).height();\n                    var scrollPosition = $(window).height() + $(window).scrollTop();\n                    if ((scrollHeight - scrollPosition) / scrollHeight === 0) {\n                        // when scroll to bottom of the page\n                        start = $(SELECTORS.MAINPAGEREVIEW).attr('data-end');\n                        $(SELECTORS.MAINPAGEREVIEW).attr('data-end', Number(start) + 10);\n                        limit = $(SELECTORS.MAINPAGEREVIEW).attr('data-end');\n                        start = Number(start) + 1;\n                        isModified = false;\n                        init(rating, start, limit, coursecontext);\n                        console.log(\"data lazy loaded\");\n                    }\n                });\n                $(\"#page\").on('scroll', function () {\n                    if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {\n                        start = $(SELECTORS.MAINPAGEREVIEW).attr('data-end');\n                        $(SELECTORS.MAINPAGEREVIEW).attr('data-end', Number(start) + 10);\n                        limit = $(SELECTORS.MAINPAGEREVIEW).attr('data-end');\n                        start = Number(start) + 1;\n                        isModified = false;\n                        init(rating, start, limit, coursecontext);\n                        console.log(\"data lazy loaded\");\n                    }\n                });\n                $('.showmorepagereviewselector').change(function () {\n                    rating = $('.showmorepagereviewselector option:selected').attr('value');\n                    isModified = true;\n                    init(rating, 0, 10, coursecontext);\n                });\n                $(document).on('change', '.ernr_showmorepagecoursemenu', function () {\n                    rating = $('.showmorepagereviewselector option:selected').attr('value');\n                    coursecontext = $('.ernr_showmorepagecoursemenu option:selected').attr('value');\n                    console.log(\"course item selected\");\n                    console.log(coursecontext);\n                    isModified = true;\n                    init(rating, 0, 10, coursecontext);\n                });\n            }\n        };\n\n\n    });\n\n/**\n       * Get and show the recent items into the block.\n       *\n       * @param {object} root The root element for the items block.\n       */\n"],"names":["define","$","Ajax","Notification","isModified","rating","coursecontext","SELECTORS","init","value","start","limit","contextid","call","methodname","args","startlimit","lastlimit","done","data","replaceData","appendData","fail","console","log","exception","append","empty","document","ready","getCourselist","attr","window","on","scrollHeight","height","scrollTop","Number","this","innerHeight","change"],"mappings":"AAEAA,sDAAO,CAAC,SACJ,YACA,oBACA,iBACA,2CAEA,SACIC,EACAC,KACAC,kBAEIC,YAAa,EACbC,OAAS,EACTC,cAAgB,GAEhBC,yBACgB,kBADhBA,iCAGwB,+BAIxBC,KAAO,SAAUC,MAAOC,MAAOC,MAAOC,WACtCN,cAAgBM,UAChBV,KAAKW,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CAAEV,OAAQI,MAAOO,WAAYN,MAAOO,UAAWN,MAAOC,UAAWN,eACvEY,KAAM,SAAUC,MACM,GAAdf,WACAgB,YAAYD,MAEZE,WAAWF,MAEfd,OAASI,OAEba,KAAM,WACFC,QAAQC,IAAIrB,aAAasB,gBAsBjCJ,WAAa,SAAUF,MACvBlB,EAAEM,0BAA0BmB,OAAOP,OAGnCC,YAAc,SAAUD,MACZ,IAARA,KACAlB,EAAEM,0BAA0BoB,QAAQD,OAAO,mBAE3CzB,EAAEM,0BAA0BoB,QAAQD,OAAOP,aAK5C,CACHX,KAAM,SAAUC,MAAOC,MAAOC,MAAOL,eACjCL,EAAE2B,UAAUC,OAAM,WACdrB,KAAKC,MAAOC,MAAOC,MAAOL,eA/BlB,SAAUA,eAC1BiB,QAAQC,IAAI,kBACZtB,KAAKW,KAAK,CAAC,CACPC,WAAY,0CACZC,KAAM,CAAET,cAAeA,eACvBY,KAAM,SAAUC,MACZlB,EAAEM,kCAAkCoB,QAAQD,OAAOP,OAEvDG,KAAM,WACFC,QAAQC,IAAIrB,aAAasB,eAuBzBK,CAAcxB,eACdL,EAAE,6CAA+CQ,MAAQ,MAAMsB,KAAK,WAAY,YAChF9B,EAAE,8CAAgDK,cAAgB,MAAMyB,KAAK,WAAY,eAK7F9B,EAAE+B,QAAQC,GAAG,UAAU,eACfC,aAAejC,EAAE2B,UAAUO,UAE1BD,cADgBjC,EAAE+B,QAAQG,SAAWlC,EAAE+B,QAAQI,cACdF,cAAiB,IAEnDxB,MAAQT,EAAEM,0BAA0BwB,KAAK,YACzC9B,EAAEM,0BAA0BwB,KAAK,WAAYM,OAAO3B,OAAS,IAC7DC,MAAQV,EAAEM,0BAA0BwB,KAAK,YACzCrB,MAAQ2B,OAAO3B,OAAS,EACxBN,YAAa,EACbI,KAAKH,OAAQK,MAAOC,MAAOL,eAC3BiB,QAAQC,IAAI,wBAGpBvB,EAAE,SAASgC,GAAG,UAAU,WAChBhC,EAAEqC,MAAMF,YAAcnC,EAAEqC,MAAMC,eAAiBtC,EAAEqC,MAAM,GAAGJ,eAC1DxB,MAAQT,EAAEM,0BAA0BwB,KAAK,YACzC9B,EAAEM,0BAA0BwB,KAAK,WAAYM,OAAO3B,OAAS,IAC7DC,MAAQV,EAAEM,0BAA0BwB,KAAK,YACzCrB,MAAQ2B,OAAO3B,OAAS,EACxBN,YAAa,EACbI,KAAKH,OAAQK,MAAOC,MAAOL,eAC3BiB,QAAQC,IAAI,wBAGpBvB,EAAE,+BAA+BuC,QAAO,WACpCnC,OAASJ,EAAE,+CAA+C8B,KAAK,SAC/D3B,YAAa,EACbI,KAAKH,OAAQ,EAAG,GAAIC,kBAExBL,EAAE2B,UAAUK,GAAG,SAAU,gCAAgC,WACrD5B,OAASJ,EAAE,+CAA+C8B,KAAK,SAC/DzB,cAAgBL,EAAE,gDAAgD8B,KAAK,SACvER,QAAQC,IAAI,wBACZD,QAAQC,IAAIlB,eACZF,YAAa,EACbI,KAAKH,OAAQ,EAAG,GAAIC"}